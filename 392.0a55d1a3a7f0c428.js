"use strict";(self.webpackChunkvelzon=self.webpackChunkvelzon||[]).push([[392],{75922:(B,x,d)=>{d.d(x,{X:()=>T});var n=d(67569),b=d(45312),f=d(21413),e=d(54438),C=d(21626);let T=(()=>{class O extends n.d{constructor(_){super(_,b.c.apiUrl+"Agent/"),this.clientNumber=new f.B,this.clientNumber$=this.clientNumber.asObservable()}GetAgentLookUps(){return this.http.get(this.baseUrl+"AgentLookUps")}getOrders(_){return this.http.post(this.baseUrl+"ClientOrders",_)}getInvoices(_){return this.http.post(this.baseUrl+"ClientInvoices",_)}GetByMobile(_){return this.http.get(this.baseUrl+"GetByMobile/"+_)}AddLocation(_){return this.http.post(this.baseUrl+"AddLocation",_)}EditLocation(_){return this.http.put(this.baseUrl+"EditLocation",_)}DeleteLocation(_){return this.http.delete(this.baseUrl+"DeleteLocation/"+_,this.httpOptions)}static{this.\u0275fac=function(M){return new(M||O)(e.KVO(C.Qq))}}static{this.\u0275prov=e.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}}return O})()},33826:(B,x,d)=>{d.d(x,{Q:()=>C});var n=d(67569),b=d(45312),f=d(54438),e=d(21626);let C=(()=>{class T extends n.d{constructor(l){super(l,b.c.apiUrl+"Order/")}GetOrderLookUp(){return this.http.get(this.baseUrl+"OrderLookUp")}districtsByCity(l){return this.http.get(this.baseUrl+"districtsByCity/"+l)}registerNewOrder(l){return this.http.post(this.baseUrl+"RegisterNewOrder",l)}EditOrder(l){return this.http.post(this.baseUrl+"EditOrder",l)}getServicesByCategory(l){return this.http.post(this.baseUrl+"servicesByCategory",l)}getPendingOrders(l){return this.http.post(this.baseUrl+"GetAllPendingOrder",l)}getRecallOrders(l){return this.http.post(this.baseUrl+"GetAllRecallOrder",l)}getAfterSale(l){return this.http.post(this.baseUrl+"GetAfterSale",l)}UpdateCallCounter(l){return this.http.put(this.baseUrl+"UpdateCallCounter/"+l,{})}SubmitOrder(l){return this.http.put(this.baseUrl+"SureOrder/"+l,{})}assignOrder(l){return this.http.put(this.baseUrl+"AssignOrder/"+l,{})}SureOrderRollBack(l){return this.http.put(this.baseUrl+"SureOrderRollBack/"+l,{})}GetChartData(l){return this.http.post(this.baseUrl+"GetDailySummary",l)}GetTotalOrderSummaryChart(l){return this.http.post(this.baseUrl+"GetTotalOrderSummaryChart",l)}GetTotalOrderTableSummaryChart(l){return this.http.post(this.baseUrl+"GetTotalOrderTableSummaryChart",l)}GetChartLookup(){return this.http.get(this.baseUrl+"GetChartLookup")}GetTimeAvailableLookup(){return this.http.get(this.baseUrl+"GetTimeAvailableLookup")}GetAvailableTime(l){return this.http.post(this.baseUrl+"GetAvailableTime",l)}ReopenOrder(l){return this.http.put(this.baseUrl+"ReopenOrder",l)}CancelOrder(l){return this.http.put(this.baseUrl+"CancelOrder",l)}ChangeTeamStatus(l){return this.http.put(this.baseUrl+"ChangeTeamStatus",l)}GetById(l){return this.http.get(this.baseUrl+"GetById/"+l)}GoLead(l){return this.http.get(this.baseUrl+"GoLead/"+l)}GetOrderTimeLine(l){return this.http.get(this.baseUrl+"GetOrderTimeLine/"+l)}SaveNoAnswer(l){return this.http.get(this.baseUrl+"SaveNoAnswer/"+l)}RemoveAssign(l){return this.http.put(this.baseUrl+"RemoveAssign/"+l,{})}GetTeamByCity(l){return this.http.post(this.baseUrl+"GetTeamByCity",l)}GetOrderAssign(l){return this.http.post(b.c.apiUrl+"OrderAssign/GetMappAssignedAll",l)}GetOrderAssignDetails(l){return this.http.post(b.c.apiUrl+"OrderAssign/GetOrderDetails",l)}GetLocations(l){return this.http.post(b.c.apiUrl+"OrderAssign/GetOrderLocations",l)}GetTestOrdersJson(){return this.http.get("/assets/testorder.json")}getTeamStatus(){return[{id:0,name:"callClientAndSure"},{id:1,name:"enRouteToCustomer"},{id:2,name:"arrivedAtLocation"},{id:3,name:"startWork"},{id:4,name:"clientNotResponse"},{id:5,name:"requestCancellation"},{id:6,name:"clientDelayOrder"}]}static{this.\u0275fac=function(_){return new(_||T)(f.KVO(e.Qq))}}static{this.\u0275prov=f.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}}return T})()},75392:(B,x,d)=>{d.d(x,{L:()=>Be});var n=d(21413),b=d(56977),f=d(36158),e=d(54438),C=d(8147),T=d(33826),O=d(3888),l=d(1530),_=d(60177),M=d(69005),v=d(89417),R=d(29935),U=d(80388),D=d(75922),L=d(72510),P=d(41631);function $(s,g){if(1&s){const t=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.checkByMobile())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"general.search")))}function V(s,g){if(1&s){const t=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.checkByOrderCode())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"general.search")))}function w(s,g){1&s&&(e.j41(0,"div",21),e.EFF(1," general.message.filedIdRequired "),e.k0s())}let X=(()=>{class s{constructor(t,i,r,o,h){this.translateService=t,this.baseService=i,this.clientService=r,this.alertService=o,this.ngxLoader=h,this.form={},this.keySelected="",this.notifier=new n.B,this.mainDelay=100,this.loaderSearchShap=f.cX,this.loaderOperationShap=f.$$,this.operationLoader=f.ZW,this.isEditForm=!1,this.showEdit=!1,this.channels=[],this.districts=[],this.cities=[],this.orderTypes=[],this.isInner=!1,this.paymentTypes=[],this.isClientFound=!0,this.errorMessage="",this.setFormByOrderCode=new e.bkB,this.calacTotal=new e.bkB,this.isOrderEdit=!0}ngOnDestroy(){this.notifier.next(),this.notifier.complete()}ngOnInit(){this.form.orderCode>0?this.checkByOrderCode():this.form.agent.mobile>0&&this.checkByMobile(),this.clientService.clientNumber$.subscribe(()=>{this.checkByMobile(!1)})}getDistricts(t){this.ngxLoader.startLoader(f.ZW),this.baseService.districtsByCity(t).pipe((0,b.Q)(this.notifier)).subscribe(i=>{this.districts=i.data,this.ngxLoader.stopLoader(f.ZW)},i=>{console.log(i)})}mapRegisterForm(t){let i={...t};return i.id=0,i}getTranslationText(t){let i="";return this.translateService.get(t).pipe((0,b.Q)(this.notifier)).subscribe(r=>{i=r}),i}checkByOrderCode(){this.ngxLoader.startLoader("order"),this.baseService.GetById(this.form.orderCode).pipe((0,b.Q)(this.notifier)).subscribe(t=>{t.success?(this.ngxLoader.stopLoader("order"),this.setFormByOrderCode.next(t.data)):(this.ngxLoader.stopLoader("order"),this.alertService.error())},()=>{this.ngxLoader.stopLoader("order"),this.alertService.error()})}checkByMobile(t=!0){this.validatePhoneNumber(this.form.agent.mobile)?(this.ngxLoader.startLoader("order"),this.clientService.GetByMobile(this.form.agent.mobile).pipe((0,b.Q)(this.notifier)).subscribe(i=>{i.success?(this.form.agent.agentName=i.data.agentName,this.form.agent.agentCode=i.data.agentCode,this.form.agent.cityCode=i.data.cityCode,this.form.agent.agentAddStatusCode=2,this.form.locations=this.getCityName(i.data.locations),this.getDistricts(i.data.cityCode),t&&this.alertService.success("orderManagement.order.clientFound"),this.isClientFound=!0):(this.isClientFound=!1,t&&this.alertService.error("orderManagement.order.clientNotFound")),this.ngxLoader.stopLoader("order")},()=>{this.ngxLoader.stopLoader("order")})):this.alertService.error(this.errorMessage)}getCityName(t){return t.forEach(i=>{var r=this.cities.find(o=>o.id==i.cityCode);r&&(i.cityName=r.name)}),t}validatePhoneNumber(t){return this.errorMessage="",10!==t.length?(this.errorMessage="orderManagement.order.phoneMust10Digit",!1):t.startsWith("05")?/^\d+$/.test(t)?(this.errorMessage="",!0):(this.errorMessage="orderManagement.order.phoneMustContainOnlyDigit",!1):(this.errorMessage="orderManagement.order.phoneMustStart05.",!1)}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(C.c$),e.rXU(T.Q),e.rXU(D.X),e.rXU(O.u),e.rXU(l.eD))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-client-info"]],inputs:{form:"form",channels:"channels",districts:"districts",cities:"cities",orderTypes:"orderTypes",isInner:"isInner",isOrderEdit:"isOrderEdit"},outputs:{setFormByOrderCode:"setFormByOrderCode",calacTotal:"calacTotal"},decls:37,vars:23,consts:[["mobile","ngModel"],["orderCode","ngModel"],["agentName","ngModel"],[1,"row","mt-4"],[1,"col-12","col-md-6","mb-3"],["for","mobile","translate","",1,"required","fw-bold","form-label"],[1,"input-group"],["InputTirmFilter","","name","mobile","type","search","maxlength","10","minlength","10","id","mobile","required","",1,"form-control","fs-6",3,"keydown.enter","ngModelChange","disabled","ngModel"],["class","btn btn-primary","type","button","id","button-addon2",3,"click",4,"ngIf"],["for","mobile","translate","",1,"fw-bold","form-label"],["InputTirmFilter","","name","orderCode","type","search","id","orderCode",1,"form-control","fs-6",3,"ngModelChange","disabled","ngModel"],["for","name","translate","",1,"required","fw-bold","form-label"],["InputTirmFilter","","name","agentName","type","text","id","agentName","required","",1,"form-control","fs-6",3,"ngModelChange","disabled","ngModel"],["class","text-danger text-center  ","translate","",4,"ngIf"],["translate","",1,"required","fw-bold","form-label","w-100"],["name","cityCode","bindValue","id","bindLabel","name","required","",3,"ngModelChange","disabled","items","multiple","ngModel"],["translate","",1,"fw-bold","form-label","w-100"],["name","cityCode","bindValue","id","bindLabel","name",3,"ngModelChange","disabled","items","multiple","ngModel"],["name","channelCode","bindValue","id","bindLabel","name",3,"ngModelChange","disabled","filter","items","multiple","ngModel"],["name","isUrgent","inputId","isUrgent",3,"ngModelChange","ngModel"],["type","button","id","button-addon2",1,"btn","btn-primary",3,"click"],["translate","",1,"text-danger","text-center"]],template:function(i,r){if(1&i){const o=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"label",5),e.EFF(3,"orderManagement.order.mobile"),e.k0s(),e.j41(4,"div",6)(5,"input",7,0),e.bIt("keydown.enter",function(){return e.eBV(o),e.Njj(r.checkByMobile())}),e.mxI("ngModelChange",function(u){return e.eBV(o),e.DH7(r.form.agent.mobile,u)||(r.form.agent.mobile=u),e.Njj(u)}),e.k0s(),e.DNE(7,$,3,3,"button",8),e.k0s()(),e.j41(8,"div",4)(9,"label",9),e.EFF(10,"orderManagement.order.orderCode"),e.k0s(),e.j41(11,"div",6)(12,"input",10,1),e.mxI("ngModelChange",function(u){return e.eBV(o),e.DH7(r.form.orderCode,u)||(r.form.orderCode=u),e.Njj(u)}),e.k0s(),e.DNE(14,V,3,3,"button",8),e.k0s()(),e.j41(15,"div",4)(16,"label",11),e.EFF(17,"orderManagement.order.name"),e.k0s(),e.j41(18,"input",12,2),e.mxI("ngModelChange",function(u){return e.eBV(o),e.DH7(r.form.agent.agentName,u)||(r.form.agent.agentName=u),e.Njj(u)}),e.k0s(),e.DNE(20,w,2,0,"div",13),e.k0s(),e.j41(21,"div",4)(22,"label",14),e.EFF(23,"orderManagement.order.cityName"),e.k0s(),e.j41(24,"ng-select",15),e.mxI("ngModelChange",function(u){return e.eBV(o),e.DH7(r.form.agent.cityCode,u)||(r.form.agent.cityCode=u),e.Njj(u)}),e.k0s()(),e.j41(25,"div",4)(26,"label",16),e.EFF(27,"orderManagement.order.districtName"),e.k0s(),e.j41(28,"ng-select",17),e.mxI("ngModelChange",function(u){return e.eBV(o),e.DH7(r.form.districtCode,u)||(r.form.districtCode=u),e.Njj(u)}),e.k0s()(),e.j41(29,"div",4)(30,"label",16),e.EFF(31,"orderManagement.order.channelName"),e.k0s(),e.j41(32,"ng-select",18),e.mxI("ngModelChange",function(u){return e.eBV(o),e.DH7(r.form.channelCode,u)||(r.form.channelCode=u),e.Njj(u)}),e.k0s()(),e.j41(33,"div",4)(34,"label",16),e.EFF(35,"orderManagement.order.isUrgent"),e.k0s(),e.j41(36,"p-inputSwitch",19),e.mxI("ngModelChange",function(u){return e.eBV(o),e.DH7(r.form.isUrgent,u)||(r.form.isUrgent=u),e.Njj(u)}),e.k0s()()()}if(2&i){const o=e.sdS(19);e.R7$(5),e.Y8G("disabled",r.isInner),e.R50("ngModel",r.form.agent.mobile),e.R7$(2),e.Y8G("ngIf",!r.isInner),e.R7$(5),e.Y8G("disabled",r.isInner),e.R50("ngModel",r.form.orderCode),e.R7$(2),e.Y8G("ngIf",!r.isInner),e.R7$(4),e.Y8G("disabled",!r.isOrderEdit),e.R50("ngModel",r.form.agent.agentName),e.R7$(2),e.Y8G("ngIf",o.invalid&&o.touched),e.R7$(4),e.Y8G("disabled",!r.isOrderEdit)("items",r.cities)("multiple",!1),e.R50("ngModel",r.form.agent.cityCode),e.R7$(4),e.Y8G("disabled",!r.isOrderEdit)("items",r.districts)("multiple",!1),e.R50("ngModel",r.form.districtCode),e.R7$(4),e.Y8G("disabled",!r.isOrderEdit)("filter",!0)("items",r.channels)("multiple",!1),e.R50("ngModel",r.form.channelCode),e.R7$(4),e.R50("ngModel",r.form.isUrgent)}},dependencies:[_.bT,v.me,v.BC,v.YS,v.xh,v.tU,v.vS,C.Mm,R.m,L.vr,P.HW,C.D9],encapsulation:2})}}return s})();var j=d(37021),k=d(35335),F=d(45236),I=d(70980),N=d(99437),A=d(18810),Y=d(25947),W=d(67569),m=d(45312),y=d(21626);let a=(()=>{class s extends W.d{constructor(t){super(t,m.c.apiUrl+"WhatsAppMessages/")}SendCallCounterMessage(t){return this.http.post(this.baseUrl+"SendCallCounterMessage/"+t,{})}SendNewOrderMessage(t){return this.http.post(this.baseUrl+"SendNewOrderMessage/"+t,{})}SendInvoiceMessage(t){return this.http.post(this.baseUrl+"SendInvoiceMessage/"+t,{})}static{this.\u0275fac=function(i){return new(i||s)(e.KVO(y.Qq))}}static{this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var p=d(12260),c=d(15084);function S(s,g){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"div",17)(2,"div",18)(3,"input",19),e.bIt("change",function(){const r=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.locationChange(r))}),e.k0s(),e.j41(4,"label",20)(5,"span",21),e.EFF(6),e.k0s(),e.j41(7,"span",22),e.EFF(8),e.k0s()()(),e.j41(9,"div",23)(10,"div")(11,"a",24),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG(),h=e.sdS(9);return e.Njj(o.openEditModal(r,h))}),e.nrm(12,"i",25)(13,"span",26),e.k0s()(),e.j41(14,"div")(15,"a",27),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG(),h=e.sdS(11);return e.Njj(o.confirm(r.id,h))}),e.nrm(16,"i",28)(17,"span",29),e.k0s()()()(),e.bVm()}if(2&s){const t=g.$implicit;e.R7$(3),e.Mz_("id","S",t.id,""),e.Y8G("checked",t.isSelected),e.R7$(),e.Mz_("for","S",t.id,""),e.R7$(2),e.Lme(" ",t.cityName,"- ",t.name,""),e.R7$(2),e.SpI(" ",t.address,"")}}function E(s,g){1&s&&(e.j41(0,"span",60),e.EFF(1,"general.action.register "),e.k0s())}function K(s,g){1&s&&(e.j41(0,"span",60),e.EFF(1,"general.action.edit "),e.k0s())}function Z(s,g){1&s&&(e.j41(0,"div",61),e.EFF(1," general.message.filedIdRequired "),e.k0s())}function J(s,g){1&s&&(e.j41(0,"div",61),e.EFF(1," general.message.filedIdRequired "),e.k0s())}function q(s,g){if(1&s){const t=e.RV6();e.j41(0,"div",30)(1,"div",31)(2,"h4",32),e.DNE(3,E,2,0,"span",33)(4,K,2,0,"span",33),e.k0s(),e.j41(5,"button",34),e.bIt("click",function(){const r=e.eBV(t).$implicit;return e.Njj(r.dismiss("Cross click"))}),e.k0s()(),e.j41(6,"div",35),e.nrm(7,"ngx-ui-loader",36),e.j41(8,"form",37,2),e.bIt("submit",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.OnSubmit())}),e.j41(10,"div",38),e.nrm(11,"label",39),e.j41(12,"ng-select",40,3),e.nI1(14,"translate"),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formEdit.cityCode,r)||(o.formEdit.cityCode=r),e.Njj(r)}),e.k0s()(),e.j41(15,"div",38),e.nrm(16,"label",41),e.j41(17,"input",42,4),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formEdit.name,r)||(o.formEdit.name=r),e.Njj(r)}),e.k0s(),e.DNE(19,Z,2,0,"div",43),e.k0s(),e.j41(20,"div",38),e.nrm(21,"label",44),e.j41(22,"textarea",45,5),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formEdit.address,r)||(o.formEdit.address=r),e.Njj(r)}),e.k0s(),e.DNE(24,J,2,0,"div",43),e.k0s(),e.j41(25,"div",38),e.nrm(26,"label",46),e.j41(27,"input",47,6),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formEdit.mapURL,r)||(o.formEdit.mapURL=r),e.Njj(r)}),e.k0s()(),e.j41(29,"div",48)(30,"div",49),e.nrm(31,"label",50),e.j41(32,"input",51,7),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formEdit.lat,r)||(o.formEdit.lat=r),e.Njj(r)}),e.k0s()(),e.j41(34,"div",49),e.nrm(35,"label",52),e.j41(36,"input",53,8),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formEdit.lng,r)||(o.formEdit.lng=r),e.Njj(r)}),e.k0s()()(),e.j41(38,"div",54)(39,"button",55),e.nrm(40,"i",56)(41,"span",57),e.k0s(),e.j41(42,"button",58),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.OnSubmit(!0))}),e.nrm(43,"i",56)(44,"span",59),e.k0s()()()()()}if(2&s){const t=e.sdS(9),i=e.sdS(18),r=e.sdS(23),o=e.XpG();e.R7$(3),e.Y8G("ngIf",!o.isEditForm),e.R7$(),e.Y8G("ngIf",o.isEditForm),e.R7$(3),e.Y8G("hasProgressBar",!1)("fgsType",o.loaderOperationShap)("loaderId","locationOperation"),e.R7$(5),e.FS9("placeholder",e.bMT(14,18,"orderManagement.order.cityName")),e.R50("ngModel",o.formEdit.cityCode),e.Y8G("items",o.cities)("multiple",!1),e.R7$(5),e.R50("ngModel",o.formEdit.name),e.R7$(2),e.Y8G("ngIf",i.invalid&&i.touched),e.R7$(3),e.R50("ngModel",o.formEdit.address),e.R7$(2),e.Y8G("ngIf",r.invalid&&r.touched),e.R7$(3),e.R50("ngModel",o.formEdit.mapURL),e.R7$(5),e.R50("ngModel",o.formEdit.lat),e.R7$(4),e.R50("ngModel",o.formEdit.lng),e.R7$(3),e.Y8G("disabled",!t.valid),e.R7$(3),e.Y8G("disabled",!t.valid)}}function z(s,g){if(1&s){const t=e.RV6();e.j41(0,"delete-modal",62),e.bIt("deleteConfirm",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.DeleteConfirm())})("dismiss",function(){const r=e.eBV(t).$implicit;return e.Njj(r.dismiss())}),e.k0s()}}let te=(()=>{class s{constructor(t,i,r,o,h,u,Q){this.modalService=t,this.baseService=i,this.alertService=r,this.ngxLoader=o,this.whatsupService=h,this.whatsAppMessagesService=u,this.cityService=Q,this.submitted=!1,this.form={},this.mainDelay=20,this.notifier=new n.B,this.operationLoader=f.ZW,this.isEditForm=!1,this.loaderOperationShap=f.$$,this.isLoad=!1,this.formEdit={},this.cities=[],this.idSelected=0,this.isOrderEdit=!0,this.modalRefs={}}ngOnInit(){this.checkLocation(),this.GetCities()}confirm(t,i){this.idSelected=t,this.modalService.open(i,{centered:!0})}openModal(t){this.ngxLoader.stopLoader(this.operationLoader),this.submitted=!1,this.modalRefs=this.modalService.open(t,{size:"md",centered:!0})}openEditModal(t,i){this.submitted=!1,this.formEdit=t,this.isEditForm=!0,this.modalRefs=this.modalService.open(i,{size:"md",centered:!0})}changeActiveTab(t){this.nav.select(t)}GetCities(){this.cityService.getDropDown().subscribe(t=>{this.cities=t.data},t=>{console.log(t)})}registerEntity(t=!1){this.ngxLoader.startLoader("locationOperation");let i=this.mapRegisterForm(this.formEdit);i.isSend=t,this.baseService.AddLocation(i).pipe((0,j.O)(),(0,k.c)(this.mainDelay),(0,F.Z)(),(0,b.Q)(this.notifier),(0,I.j)(()=>this.ngxLoader.stopLoader("locationOperation")),(0,N.W)(r=>(0,A.$)(r))).subscribe(r=>{r.success?(this.alertService.success(),this.modalRefs.dismiss(),this.refresh()):this.alertService.error("general.message."+r.message)},r=>{this.alertService.error("general.message."+r)})}editEntity(t=!1){this.ngxLoader.startLoader("locationOperation");let i=this.mapForm(this.formEdit);i.isSend=t,this.baseService.EditLocation(i).pipe((0,j.O)(),(0,k.c)(this.mainDelay),(0,F.Z)(),(0,b.Q)(this.notifier),(0,I.j)(()=>this.ngxLoader.stopLoader("locationOperation"))).subscribe(r=>{r.success?(this.alertService.success(),this.modalRefs.dismiss(),this.refresh()):this.alertService.error("general.message."+r.message)},r=>{this.alertService.error("general.message."+r)})}mapForm(t){return t.agentCode=this.form.agent.agentCode,t.agentName=this.form.agent.agentName,t.mobile=this.form.agent.mobile,t.orderCode=this.form.orderCode,t.cityCode=t.cityCode,t.mapURL=t.mapURL,t}mapRegisterForm(t){return t.id=0,t.agentCode=this.form.agent.agentCode,t.agentName=this.form.agent.agentName,t.mobile=this.form.agent.mobile,t.orderCode=this.form.orderCode,t.cityCode=t.cityCode,t.mapURL=t.mapURL,t}submitFunished(){this.alertService.success(),this.modalService?.dismissAll()}OnSubmit(t=!1){this.ngxLoader.startLoader(this.operationLoader),!0===this.isEditForm?this.editEntity(t):this.registerEntity(t)}getFromClient(){this.form.agent.mobile||this.alertService.error("orderManagement.order.mustEnterNumber"),this.isLoad=!0,this.whatsupService.GetLocationFromClient(this.form.agent.mobile).pipe((0,b.Q)(this.notifier),(0,I.j)(()=>this.isLoad=!1)).subscribe(t=>{t.success?this.alertService.success("orderManagement.order.successSendLocation"):this.alertService.error("orderManagement.order.failSendLocation")},()=>{this.alertService.error("orderManagement.order.failSendLocation")})}DeleteConfirm(){this.baseService.DeleteLocation(this.idSelected).pipe((0,j.O)(),(0,k.c)(this.mainDelay),(0,F.Z)(),(0,b.Q)(this.notifier),(0,I.j)(()=>this.ngxLoader.stopLoader("deleteLoader"))).subscribe(t=>{if(t.success){const i=this.form.locations.findIndex(r=>r.id===this.idSelected);-1!==i&&this.form.locations.splice(i,1),this.alertService.success(),this.modalService.dismissAll()}else this.alertService.error("general.message."+t)},()=>{this.alertService.error()})}refresh(){this.baseService.clientNumber.next(!0)}locationChange(t){this.form.orderLocations=[{lat:t.lat,lng:t.lng,agentLocationId:t.id,orderLocationCode:0,orderCode:0,cityId:t.cityCode,mapURL:t.mapURL}],this.form.cityCode=t.cityCode;let i=this.form.locations.find(r=>r.id==t.id);i.isSelected=!i.isSelected}checkLocation(){}ngOnDestroy(){this.notifier.next(),this.notifier.complete()}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(M.Bq),e.rXU(D.X),e.rXU(O.u),e.rXU(l.eD),e.rXU(Y.A),e.rXU(a),e.rXU(p.h))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["client-location"]],viewQuery:function(i,r){if(1&i&&e.GBs(M.X9,5),2&i){let o;e.mGM(o=e.lsd())&&(r.nav=o.first)}},inputs:{form:"form",isOrderEdit:"isOrderEdit"},features:[e.Jv_([M.X9])],decls:12,vars:2,consts:[["content",""],["deleteModal",""],["formEntity","ngForm"],["cityCode","ngModel"],["name","ngModel"],["address","ngModel"],["mapURL","ngModel"],["lat","ngModel"],["lng","ngModel"],[1,"mt-4"],[1,"d-flex","align-items-center","mb-2"],[1,"flex-grow-1"],["translate","orderManagement.order.savedAddress",1,"fs-15","mb-0"],[1,"flex-shrink-0"],["type","button","translate","orderManagement.order.sendToClient",1,"btn","btn-sm","btn-success","mb-1",3,"click","disabled"],[1,"row","gy-3"],[4,"ngFor","ngForOf"],[1,"col-lg-4","col-sm-6"],[1,"form-check","card-radio"],["name","location","type","radio",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label",3,"for"],[1,"mb-4","fw-bold","d-block","text-muted","text-uppercase"],[1,"text-muted","fw-normal","text-wrap","mb-1","d-block"],[1,"d-flex","flex-wrap","p-2","py-1","bg-light","rounded-bottom","border","mt-n1"],["href","javascript:void(0);","data-bs-toggle","modal","data-bs-target","#addAddressModal",1,"d-block","text-body","p-1","px-2",3,"click"],[1,"ri-pencil-fill","text-muted","align-bottom","me-1"],["translate","general.action.edit"],["href","javascript:void(0);","data-bs-toggle","modal","data-bs-target","#removeItemModal",1,"d-block","text-body","p-1","px-2",3,"click"],[1,"ri-delete-bin-fill","text-muted","align-bottom","me-1"],["translate","general.action.delete"],[1,"modal-content","border-0"],[1,"modal-header","p-3","bg-info-subtle"],[1,"card-title","mb-0"],["class","fw-bold fs-4","translate","",4,"ngIf"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[3,"hasProgressBar","fgsType","loaderId"],[3,"submit"],[1,"mb-1"],["for","name","translate","orderManagement.order.cityName",1,"required","fw-bold","form-label"],["name","cityCode","id","cityCode","bindValue","code","bindLabel","name",3,"ngModelChange","ngModel","placeholder","items","multiple"],["for","name","translate","orderManagement.order.name",1,"required","fw-bold","form-label"],["InputTirmFilter","","name","name","type","text","id","name","required","",1,"form-control","fs-6",3,"ngModelChange","ngModel"],["class","text-danger text-center  ","translate","",4,"ngIf"],["for","address","translate","orderManagement.order.address",1,"fw-bold","form-label"],["rows","2","InputTirmFilter","","name","address","type","text","id","address",1,"form-control","fs-6",3,"ngModelChange","ngModel"],["for","mapURL","translate","orderManagement.order.mapURL",1,"fw-bold","form-label"],["InputTirmFilter","","name","mapURL","type","text","id","mapURL",1,"form-control","fs-6",3,"ngModelChange","ngModel"],[1,"row","my-2"],[1,"col-12","col-md-6"],["for","lat","translate","orderManagement.order.lat",1,"fw-bold","form-label"],["InputTirmFilter","","name","lat","type","text","id","lat",1,"form-control","fs-6",3,"ngModelChange","ngModel"],["for","lng","translate","orderManagement.order.lng",1,"fw-bold","form-label"],["InputTirmFilter","","name","lng","type","text","id","lng",1,"form-control","fs-6",3,"ngModelChange","ngModel"],[1,"text-center"],["type","submit","type","submit",1,"btn","btn-primary","btn-label","waves-effect","waves-light","rounded-pill",3,"disabled"],[1,"ri-check-double-line","label-icon","align-middle","rounded-pill","fs-16","me-2"],["translate","general.action.save"],["type","button","type","submit",1,"mx-1","btn","btn-success","btn-label","waves-effect","waves-light","rounded-pill",3,"click","disabled"],["translate","general.action.saveAndSend"],["translate","",1,"fw-bold","fs-4"],["translate","",1,"text-danger","text-center"],[3,"deleteConfirm","dismiss"]],template:function(i,r){if(1&i){const o=e.RV6();e.j41(0,"div",9)(1,"div",10)(2,"div",11),e.nrm(3,"h5",12),e.k0s(),e.j41(4,"div",13)(5,"button",14),e.bIt("click",function(){e.eBV(o);const u=e.sdS(9);return e.Njj(r.openModal(u))}),e.k0s()()(),e.j41(6,"div",15),e.DNE(7,S,18,8,"ng-container",16),e.k0s()(),e.DNE(8,q,45,20,"ng-template",null,0,e.C5r)(10,z,1,0,"ng-template",null,1,e.C5r)}2&i&&(e.R7$(5),e.Y8G("disabled",r.isLoad),e.R7$(2),e.Y8G("ngForOf",r.form.locations))},dependencies:[_.Sq,_.bT,v.qT,v.me,v.BC,v.cb,v.YS,v.vS,v.cV,C.Mm,R.m,L.vr,l.Cv,c.w,C.D9],encapsulation:2})}}return s})();var G=d(51188);let re=(()=>{class s{constructor(t,i,r,o,h,u,Q,Ue){this.routerActive=t,this.translateService=i,this.baseService=r,this.alertService=o,this.datePipe=h,this.modalService=u,this.ngxLoader=Q,this.router=Ue,this.editOrders="orderManagement.order.editOrders",this.addOrders="orderManagement.order.addOrders",this.titleOperation="orderManagement.order.titleOperation",this.form={},this.keySelected="",this.assignUsers=[],this.times=[],this.active=0,this.shifts=[],this.searchForm="",this.jobTypes=[],this.weekDays=[],this.breadCrumbItems=[],this.todayDate="",this.idForm=0,this.totalPaid=0,this.priceModel=0,this.priceModelIndex=0,this.subtotal=0,this.total=0,this.isResolveList=!0,this.extraDiscountCalc=!1,this.employeeGroups=[],this.notifier=new n.B,this.mainDelay=100,this.loaderSearchShap=f.cX,this.loaderOperationShap=f.$$,this.operationLoader=f.ZW,this.isEditForm=!1,this.showEdit=!1,this.channels=[],this.districts=[],this.cities=[],this.orderTypes=[],this.serviceCategories=[],this.services=[],this.paymentTypes=[],this.fileName="",this.base64String=null,this.orderCode=[],this.newOrder=new e.bkB;const H=new Date;this.todayDate=`${H.getFullYear()}-${(H.getMonth()+1).toString().padStart(2,"0")}-${H.getDate().toString().padStart(2,"0")}`,console.log(this.todayDate)}nextDate(){let t=this.todayDate.split("-");this.todayDate=`${t[0]}-${t[1]}-${+t[2]+1}`,console.log(this.todayDate)}OpenChangInput(t,i){this.showEdit=!0,console.log(i),this.priceModel=i.price,this.priceModelIndex=t}ChangInput(){this.form.tbOrderServices[`${this.priceModelIndex}`].price=this.priceModel,this.showEdit=!1}previousDate(){let t=this.todayDate.split("-");this.todayDate=`${t[0]}-${t[1]}-${+t[2]-1}`,console.log(this.todayDate)}ngOnDestroy(){this.notifier.next(),this.notifier.complete()}ngOnInit(){this.configRoute(),this.breadCrumbItems=[{label:"layout.sidebar.orders"},{label:"orderManagement.order.title",active:!0,url:"order/list"},{label:this.isEditForm?"general.action.edit":"general.action.register",active:!0}],this.GetOrderLookUp()}onFileSelected(t){const i=t.target;if(i.files&&i.files.length>0){const r=i.files[0];this.fileName=r.name,console.log(r);const o=new FileReader;o.onload=()=>{this.base64String=o.result,console.log("Base64 String:",this.base64String)},o.onerror=h=>{console.error("Error reading file:",h)},o.readAsDataURL(r)}}addService(){let t=this.form.formServices,i=this.services.filter(o=>o.serviceCode==t.serviceCode)[0];this.form.tbOrderServices.push({service:i.name,serviceCode:i.code,price:t.price,notes:t.notes});let r=0;this.form.tbOrderServices.forEach(o=>{r+=+o.price}),this.subtotal=r,console.log(this.subtotal),this.checkTotal(),this.resetServiceForm()}addPayment(){let t=this.form.formPayment,i=this.paymentTypes.filter(o=>o.id==t.paymentTypeCode)[0];this.form.orderPayments.push({paymentType:i.name,paymentTypeCode:t.paymentTypeCode,value:t.value,fileName:this.fileName});let r=0;this.form.orderPayments.forEach(o=>{r+=+o.value}),this.totalPaid=r,this.resetPaymentForm()}checkTotal(){this.total=this.subtotal-+this.form.DiscountAmount}deleteService(t){this.form.tbOrderServices.splice(t,1)}deletePayment(t){this.form.orderPayments.splice(t,1)}resetServiceForm(){let t=this.form.formServices;t.serviceCode=void 0,t.price=null,t.notes=null}resetPaymentForm(){let t=this.form.formPayment;t.paymentTypeCode=null,t.value=null,t.attachRecietPath=null,t.fileName=null}configRoute(){this.routerActive.data.pipe((0,b.Q)(this.notifier)).subscribe(t=>{let i=t.data.data;i&&(this.isEditForm=!0,this.form=i,"Proposed"==i.leadsTypes?this.form.leadsTypes=1:"Inquiry"==i.leadsTypes&&(this.form.leadsTypes=2))},()=>{this.alertService.error()})}GetOrderLookUp(){this.baseService.GetOrderLookUp().subscribe(t=>{this.channels=t.data.channels,this.cities=t.data.cityNames,this.orderTypes=t.data.orderStatus,this.serviceCategories=t.data.serviceCategories,this.paymentTypes=t.data.paymentTypes},t=>{console.log(t)})}getDistricts(t){this.ngxLoader.startLoader(f.ZW),this.baseService.districtsByCity(t).subscribe(i=>{this.districts=i.data,this.ngxLoader.stopLoader(f.ZW)},i=>{console.log(i)})}getServicesByCategory(t){console.log(t),this.ngxLoader.startLoader(f.ZW),this.baseService.getServicesByCategory(t).subscribe(i=>{this.ngxLoader.stopLoader(f.ZW),this.services=i.data},i=>{console.log(i)})}OnSubmit(){this.ngxLoader.startLoader(this.operationLoader),!0===this.isEditForm?this.editEntity():this.registerEntity()}mapRegisterForm(t){let i={...t};return i.id=0,i}registerEntity(){this.ngxLoader.startLoader(f.ZW);let t=this.mapRegisterForm(this.form);this.baseService.registerNewOrder(t).pipe((0,j.O)(),(0,k.c)(this.mainDelay),(0,F.Z)(),(0,b.Q)(this.notifier),(0,I.j)(()=>this.ngxLoader.stopLoader(f.ZW)),(0,N.W)(i=>(0,A.$)(i))).subscribe(i=>{i.success?(this.alertService.success(),this.router.navigateByUrl("/order/list")):this.alertService.error("general.message."+i.message)},i=>{this.alertService.error("general.message."+i)})}editEntity(){this.baseService.editPut(this.form.id,this.form).pipe((0,j.O)(),(0,k.c)(this.mainDelay),(0,F.Z)(),(0,b.Q)(this.notifier),(0,I.j)(()=>this.ngxLoader.stopLoader(f.ZW))).subscribe(t=>{t.success?this.alertService.success():this.alertService.error("general.message."+t.message)},t=>{this.alertService.error("general.message."+t)})}getTranslationText(t){let i="";return this.translateService.get(t).pipe((0,b.Q)(this.notifier)).subscribe(r=>{i=r}),i}onTimeSelected(t){this.form.orderTeams=t}newOrderAgain(){this.newOrder.next(!0)}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(G.nX),e.rXU(C.c$),e.rXU(T.Q),e.rXU(O.u),e.rXU(_.vh),e.rXU(M.Bq),e.rXU(l.eD),e.rXU(G.Ix))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-finish-order"]],inputs:{form:"form",orderCode:"orderCode"},outputs:{newOrder:"newOrder"},decls:12,vars:1,consts:[[1,"text-center","py-5"],[1,"mb-4"],["src","https://cdn.lordicon.com/lupuorrc.json","trigger","loop","colors","primary:#0ab39c,secondary:#405189",2,"width","120px","height","120px"],["translate","orderManagement.order.orderSaveSuccess"],[1,"fw-semibold"],["translate","orderManagement.order.orderCode"],["routerLink","/ecommerce/order-details",1,"text-decoration-underline"],[1,"d-flex","align-items-start","gap-3","mt-4"],["type","button","data-nexttab","pills-finish-tab",1,"btn","btn-primary","btn-label","right","ms-auto","nexttab",3,"click"],[1,"ri-chat-new-line","label-icon","align-middle","fs-16","ms-2"],["translate","orderManagement.order.newOrderAgain"]],template:function(i,r){1&i&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"lord-icon",2),e.k0s(),e.nrm(3,"h5",3),e.j41(4,"h3",4),e.nrm(5,"span",5),e.j41(6,"a",6),e.EFF(7),e.k0s()()(),e.j41(8,"div",7)(9,"button",8),e.bIt("click",function(){return r.newOrderAgain()}),e.nrm(10,"i",9)(11,"span",10),e.k0s()()),2&i&&(e.R7$(7),e.SpI("#SO#",r.orderCode,""))},dependencies:[C.Mm,G.Wk],encapsulation:2})}}return s})();var ie=d(99902);function ne(s,g){if(1&s){const t=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.addPayment())}),e.nrm(1,"i",39),e.k0s()}}function oe(s,g){if(1&s){const t=e.RV6();e.j41(0,"button",40),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.editPaymentNew())}),e.nrm(1,"i",41),e.k0s()}}function se(s,g){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"div",28)(2,"label",29),e.EFF(3," orderManagement.order.paymentMethods"),e.k0s(),e.j41(4,"ng-select",30),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formPayment.paymentTypeCode,r)||(o.formPayment.paymentTypeCode=r),e.Njj(r)}),e.k0s()(),e.j41(5,"div",28)(6,"label",31),e.EFF(7,"orderManagement.order.paid"),e.k0s(),e.j41(8,"input",32,0),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formPayment.value,r)||(o.formPayment.value=r),e.Njj(r)}),e.k0s()(),e.j41(10,"div",33)(11,"label",31),e.EFF(12,"orderManagement.order.paid"),e.k0s(),e.j41(13,"input",34,1),e.bIt("change",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFileSelected(r))}),e.k0s()(),e.j41(15,"div",35),e.DNE(16,ne,2,0,"button",36)(17,oe,2,0,"button",37),e.k0s(),e.bVm()}if(2&s){const t=e.XpG();e.R7$(4),e.Y8G("items",t.paymentTypes)("multiple",!1),e.R50("ngModel",t.formPayment.paymentTypeCode),e.R7$(4),e.R50("ngModel",t.formPayment.value),e.R7$(8),e.Y8G("ngIf",!t.isEdit),e.R7$(),e.Y8G("ngIf",t.isEdit)}}function ae(s,g){if(1&s&&e.nrm(0,"img",48),2&s){const t=e.XpG().$implicit,i=e.XpG();e.Y8G("src",i.serverUrl+t.url,e.B4B)("alt",t.name)}}function le(s,g){if(1&s){const t=e.RV6();e.j41(0,"tr",42)(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.DNE(8,ae,1,2,"img",43),e.k0s(),e.j41(9,"td")(10,"button",44),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.editPayment(r))}),e.nrm(11,"i",45),e.k0s(),e.j41(12,"button",46),e.bIt("click",function(){const r=e.eBV(t).index,o=e.XpG();return e.Njj(o.deletePayment(r))}),e.nrm(13,"i",47),e.k0s()()()}if(2&s){const t=g.$implicit,i=g.index;e.R7$(2),e.JRh(i+1),e.R7$(2),e.JRh(t.paymentType),e.R7$(2),e.JRh(t.value),e.R7$(2),e.Y8G("ngIf",t.url)}}function de(s,g){1&s&&(e.j41(0,"tr")(1,"td",49),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s&&(e.R7$(2),e.JRh(e.bMT(3,1,"orderManagement.order.noData")))}function ce(s,g){if(1&s){const t=e.RV6();e.j41(0,"button",50),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.orderFinished())}),e.nrm(1,"i",51)(2,"span",52),e.k0s()}}function me(s,g){if(1&s){const t=e.RV6();e.j41(0,"button",54),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.orderEdit())}),e.nrm(1,"i",55)(2,"span",56),e.k0s()}}function pe(s,g){if(1&s&&(e.qex(0),e.DNE(1,me,3,0,"button",53),e.bVm()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.form.orderCode>0)}}let he=(()=>{class s{constructor(t,i,r,o,h,u){this.routerActive=t,this.translateService=i,this.baseService=r,this.alertService=o,this.formDataService=h,this.ngxLoader=u,this.editOrders="orderManagement.order.editOrders",this.addOrders="orderManagement.order.addOrders",this.titleOperation="orderManagement.order.titleOperation",this.form={},this.keySelected="",this.assignUsers=[],this.times=[],this.active=0,this.shifts=[],this.searchForm="",this.jobTypes=[],this.weekDays=[],this.breadCrumbItems=[],this.todayDate="",this.idForm=0,this.totalPaid=0,this.priceModel=0,this.priceModelIndex=0,this.subtotal=0,this.total=0,this.isResolveList=!0,this.extraDiscountCalc=!1,this.employeeGroups=[],this.notifier=new n.B,this.mainDelay=100,this.loaderSearchShap=f.cX,this.loaderOperationShap=f.$$,this.operationLoader=f.ZW,this.isEditForm=!1,this.showEdit=!1,this.channels=[],this.districts=[],this.cities=[],this.orderTypes=[],this.paymentTypes=[],this.fileName="",this.base64String=null,this.formPayment={},this.isEdit=!1,this.finishedOrder=new e.bkB,this.finishedUpdateOrder=new e.bkB,this.CalcTotal=new e.bkB,this.isOrderEdit=!0,this.serverUrl=m.c.mediaUrl,this.isCash=!0}OpenChangInput(t,i){this.showEdit=!0,this.priceModel=i.price,this.priceModelIndex=t}ChangInput(){this.form.tbOrderServices[`${this.priceModelIndex}`].price=this.priceModel,this.showEdit=!1}ngOnDestroy(){this.notifier.next(),this.notifier.complete()}ngOnInit(){}onFileSelected(t){const i=t.target;if(i.files&&i.files.length>0){const r=i.files[0];this.fileSelected=r,this.fileName=r.name;const o=new FileReader;o.onload=()=>{this.base64String=o.result},o.onerror=h=>{console.error("Error reading file:",h)},o.readAsDataURL(r),i.value=""}}addPayment(){let t=this.formPayment;if(t.value>this.form.total)return void this.alertService.error("orderManagement.order.addCostLargeTotal");let i=this.paymentTypes.filter(h=>h.id==t.paymentTypeCode)[0];this.form.orderPayments.push({orderPaymentCode:this.form.orderPaymentCode||0,orderCode:this.form.orderCode||0,paymentType:i.name,paymentTypeCode:t.paymentTypeCode,value:t.value,fileName:this.fileName,url:this.base64String,index:this.form.orderPayments.length+1,file:this.fileSelected});let o=0;this.form.orderPayments.forEach(h=>{o+=+h.value}),this.totalPaid=o,this.resetPaymentForm(),this.CalcTotal.next(!0),console.log(this.form.orderPayments)}checkTotal(){this.total=this.subtotal-+this.form.DiscountAmount}deleteService(t){this.form.tbOrderServices.splice(t,1)}deletePayment(t){this.form.orderPayments.splice(t,1),this.CalcTotal.next(!0)}resetServiceForm(){let t=this.form.formServices;t.serviceCode=void 0,t.price=null,t.notes=null}resetPaymentForm(){this.formPayment={},this.base64String="",this.fileName=""}configRoute(){this.routerActive.data.pipe((0,b.Q)(this.notifier)).subscribe(t=>{let i=t.data.data;i&&(this.isEditForm=!0,this.form=i,"Proposed"==i.leadsTypes?this.form.leadsTypes=1:"Inquiry"==i.leadsTypes&&(this.form.leadsTypes=2))},()=>{this.alertService.error()})}getTranslationText(t){let i="";return this.translateService.get(t).pipe((0,b.Q)(this.notifier)).subscribe(r=>{i=r}),i}editPayment(t){this.isEdit=!0,this.formPayment={},this.formPayment={...t}}editPaymentNew(){let t=this.formPayment;if(0==t.orderPaymentCode){let i=this.paymentTypes.filter(o=>o.id==t.paymentTypeCode)[0],r=this.form.orderPayments.find(o=>o.index==t.index);r.paymentType=i.name,r.value=t.value,r.fileName=""==this.fileName?r.fileName:this.fileName,r.url=""==this.base64String?r.base64String:this.base64String}this.isEdit=!1,this.formPayment={},this.CalcTotal.next(!0)}onTimeSelected(t){this.form.orderTeams=t,console.log(t)}orderFinished(){if(this.isCash&&this.form.orderPayments.length<=0)return void this.alertService.error("orderManagement.order.mustAddPayment");let t=this.mapForm();this.ngxLoader.startLoader("order"),this.baseService.registerNewOrder(t).subscribe(i=>{i.success?(this.ngxLoader.stopLoader("order"),this.finishedOrder.next(i.data.orderCode),this.alertService.success()):(this.alertService.error(),this.ngxLoader.stopLoader("order"))},()=>{this.alertService.error(),this.ngxLoader.stopLoader("order")})}mapForm(){let t=this.form;delete t.locations,delete t.formServices,delete t.formPayment,delete t.serviceCategoryCode,delete t.total,t.agentCode=t.agent.agentCode;let i=[...this.form.orderPayments];return this.form.orderPayments=[],i.forEach(r=>{this.form.orderPayments.push({orderPaymentCode:r.orderPaymentCode,paymentType:r.paymentType,orderCode:r.orderCode,paymentTypeCode:r.paymentTypeCode,value:r.value,file:r.file})}),console.log(t),this.formDataService.formatFormData(t)}orderEdit(){let t=this.mapForm();this.ngxLoader.startLoader("order"),this.baseService.EditOrder(t).subscribe(i=>{i.success?(this.finishedUpdateOrder.next(i.data.orderCode),this.alertService.success(),this.ngxLoader.stopLoader("order")):(this.alertService.error(),this.ngxLoader.stopLoader("order"))},()=>{this.alertService.error(),this.ngxLoader.stopLoader("order")})}methodPayChange(t=!1){this.isCash=t}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(G.nX),e.rXU(C.c$),e.rXU(T.Q),e.rXU(O.u),e.rXU(ie.Q),e.rXU(l.eD))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-order-payment"]],inputs:{form:"form",paymentTypes:"paymentTypes",isOrderEdit:"isOrderEdit"},outputs:{finishedOrder:"finishedOrder",finishedUpdateOrder:"finishedUpdateOrder",CalcTotal:"CalcTotal"},decls:38,vars:6,consts:[["value","ngModel"],["fileInput",""],[1,"row","my-2","justify-content-around"],[1,"col-lg-4","col-sm-6"],["data-bs-toggle","collapse","data-bs-target","#paymentmethodCollapse.show","aria-expanded","true","aria-controls","paymentmethodCollapse"],[1,"form-check","card-radio"],["id","paymentMethod01","name","paymentMethod","type","radio",1,"form-check-input",3,"change","value"],["for","paymentMethod01",1,"form-check-label"],[1,"fs-16","text-muted","mx-2"],[1,"ri-paypal-fill","align-bottom"],["translate","orderManagement.order.withPayURL",1,"fs-14","text-wrap"],["data-bs-toggle","collapse","data-bs-target","#paymentmethodCollapse.show","aria-expanded","false","aria-controls","paymentmethodCollapse"],["id","paymentMethod03","name","paymentMethod","type","radio",1,"form-check-input",3,"change"],["for","paymentMethod03",1,"form-check-label"],[1,"ri-money-dollar-box-fill","align-bottom"],["translate","orderManagement.order.cashOnDelivery",1,"fs-14","text-wrap"],[1,"row","mt-3"],[4,"ngIf"],[1,"col-12","mt-3"],[1,"table-responsive"],[1,"table","table-border"],[1,""],["translate","",2,"width",".5%"],["translate","",2,"width","10%"],["translate","",2,"width","8%"],["class","fs-5",4,"ngFor","ngForOf"],[1,"d-flex","align-items-start","gap-3","mt-4"],["type","button","class","btn btn-primary   right ms-auto nexttab","data-nexttab","pills-finish-tab",3,"click",4,"ngIf"],[1,"col-6","col-md-4","mb-2"],["translate","",1,"required","fw-bold","form-label","w-100"],["name","paymentTypeCode","bindValue","id","bindLabel","name",3,"ngModelChange","items","multiple","ngModel"],["for","value","translate","",1,"fw-bold","form-label"],["InputTirmFilter","","name","value","type","number","id","value",1,"form-control","fs-6",3,"ngModelChange","ngModel"],[1,"col-6","col-md-3","mb-2"],["type","file","placeholder","dfd",1,"form-control","fs-6",3,"change"],[1,"col-6","col-md-1","mb-2","d-flex","justify-content-center","align-items-end"],["type","button","class","btn btn-success btn-icon waves-effect waves-light",3,"click",4,"ngIf"],["type","button","class","btn btn-info btn-icon waves-effect waves-light",3,"click",4,"ngIf"],["type","button",1,"btn","btn-success","btn-icon","waves-effect","waves-light",3,"click"],[1,"ri-add-fill"],["type","button",1,"btn","btn-info","btn-icon","waves-effect","waves-light",3,"click"],[1,"ri-edit-2-line"],[1,"fs-5"],["class","img-thumbnail","width","50","height","50",3,"src","alt",4,"ngIf"],[1,"btn","btn-sm","btn-soft-info","edit-list","mx-2",3,"click"],[1,"ri-pencil-fill","align-bottom","mx-1"],[1,"btn","btn-sm","btn-soft-danger","remove-list",3,"click"],[1,"ri-delete-bin-5-fill","align-bottom"],["width","50","height","50",1,"img-thumbnail",3,"src","alt"],["colspan","5",1,"text-center","text-danger","my-5"],["type","button","data-nexttab","pills-finish-tab",1,"btn","btn-primary","right","ms-auto","nexttab",3,"click"],[1,"ri-checkbox-circle-fill","label-icon","align-middle","fs-16","ms-2"],["translate","orderManagement.order.orderComplete"],["type","button","class","btn btn-info   right ms-auto nexttab","data-nexttab","pills-finish-tab",3,"click",4,"ngIf"],["type","button","data-nexttab","pills-finish-tab",1,"btn","btn-info","right","ms-auto","nexttab",3,"click"],[1,"ri-edit-2-fill","label-icon","align-middle","fs-16","ms-2"],["translate","orderManagement.order.orderEdit"]],template:function(i,r){1&i&&(e.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"input",6),e.bIt("change",function(){return r.methodPayChange(!0)}),e.k0s(),e.j41(5,"label",7)(6,"span",8),e.nrm(7,"i",9),e.k0s(),e.nrm(8,"span",10),e.k0s()()()(),e.j41(9,"div",3)(10,"div",11)(11,"div",5)(12,"input",12),e.bIt("change",function(){return r.methodPayChange(!1)}),e.k0s(),e.j41(13,"label",13)(14,"span",8),e.nrm(15,"i",14),e.k0s(),e.nrm(16,"span",15),e.k0s()()()()(),e.j41(17,"div",16),e.DNE(18,se,18,6,"ng-container",17),e.j41(19,"div",18)(20,"div",19)(21,"table",20)(22,"tr",21)(23,"th",22),e.EFF(24,"#"),e.k0s(),e.j41(25,"th",23),e.EFF(26," orderManagement.order.paymentMethods "),e.k0s(),e.j41(27,"th",23),e.EFF(28," orderManagement.order.paid "),e.k0s(),e.j41(29,"th",23),e.EFF(30," orderManagement.order.attchment "),e.k0s(),e.j41(31,"th",24),e.EFF(32," orderManagement.order.actions "),e.k0s()(),e.DNE(33,le,14,4,"tr",25)(34,de,4,3,"tr",17),e.k0s()()()(),e.j41(35,"div",26),e.DNE(36,ce,3,0,"button",27)(37,pe,2,1,"ng-container",17),e.k0s()),2&i&&(e.R7$(4),e.Y8G("value",!0),e.R7$(14),e.Y8G("ngIf",r.isCash||r.isEdit),e.R7$(15),e.Y8G("ngForOf",r.form.orderPayments),e.R7$(),e.Y8G("ngIf",r.form.orderPayments.length<=0),e.R7$(2),e.Y8G("ngIf",r.form.orderCode<=0),e.R7$(),e.Y8G("ngIf",r.isOrderEdit))},dependencies:[_.Sq,_.bT,v.me,v.Q0,v.BC,v.vS,C.Mm,R.m,L.vr,C.D9],encapsulation:2})}}return s})();var ge=d(16743),ue=d(5779),fe=d(38542);const _e=s=>({"active-category":s}),be=(s,g)=>({"ribbon-success ":s,"ribbon-primary ":g}),ve=s=>({" border-service ":s});function Ce(s,g){if(1&s){const t=e.RV6();e.j41(0,"div",16)(1,"div",17),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.chooseCategory(r))}),e.j41(2,"div",18),e.nrm(3,"img",19),e.j41(4,"span",20),e.EFF(5),e.k0s()()()()}if(2&s){const t=g.$implicit,i=e.XpG();e.R7$(),e.Mz_("id","category",t.id,""),e.Y8G("ngClass",e.eq3(6,_e,t.isSelected)),e.R7$(2),e.Y8G("width",100)("src",i.serverImage+t.imageUrl,e.B4B),e.R7$(2),e.JRh(t.name)}}function ye(s,g){if(1&s&&(e.j41(0,"span",21),e.EFF(1),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.JRh(t.seviceCount)}}function Se(s,g){1&s&&(e.j41(0,"div",22),e.nrm(1,"button",23),e.k0s())}function Te(s,g){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"div",24)(2,"div",25)(3,"div",26),e.nI1(4,"translate"),e.EFF(5),e.k0s(),e.j41(6,"input",27),e.bIt("change",function(r){const o=e.eBV(t).$implicit,h=e.XpG();return e.Njj(h.onServiceChange(o.code,r))}),e.k0s(),e.j41(7,"label",28)(8,"div",29)(9,"div",30),e.qSk(),e.j41(10,"svg",31)(11,"style"),e.EFF(12," .s0 { opacity: .06; fill: var(--vz-primary) } "),e.k0s(),e.nrm(13,"path",32),e.k0s()(),e.joV(),e.j41(14,"div",33),e.nrm(15,"img",34),e.k0s(),e.j41(16,"div",35)(17,"h5",36),e.EFF(18),e.k0s()(),e.j41(19,"h6",37),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"div",38)(23,"button",39),e.bIt("click",function(r){const o=e.eBV(t).$implicit,h=e.XpG();return e.Njj(h.btnMinus(o.code,r))}),e.EFF(24,"\u2013 "),e.k0s(),e.nrm(25,"input",40),e.j41(26,"button",41),e.bIt("click",function(r){const o=e.eBV(t).$implicit,h=e.XpG();return e.Njj(h.btnPlus(o.code,r))}),e.EFF(27,"+ "),e.k0s()()()()()(),e.bVm()}if(2&s){const t=g.$implicit,i=e.XpG();e.R7$(3),e.FS9("pTooltip",e.bMT(4,21,"orderManagement.order.serviceTime")),e.Y8G("ngClass",e.l_i(25,be,t.isSelected,!t.isSelected)),e.R7$(2),e.JRh(t.timeCount),e.R7$(),e.Mz_("id","S",t.code,""),e.Y8G("value",t.isSelected)("checked",t.isSelected),e.R7$(),e.Mz_("for","S",t.code,""),e.R7$(),e.Y8G("ngClass",e.eq3(28,ve,t.isSelected)),e.R7$(7),e.Y8G("width",150)("src",i.serverImage+t.imageUrl,e.B4B),e.R7$(3),e.JRh(t.name),e.R7$(2),e.Lme("",e.bMT(21,23,"orderManagement.order.currancy")," ",t.price," "),e.R7$(3),e.Y8G("disabled",!t.isSelected),e.R7$(2),e.Mz_("id","cart-",t.code,""),e.FS9("value",t.quantity),e.Y8G("disabled",!t.isSelected),e.R7$(),e.Y8G("disabled",!t.isSelected)}}let Oe=(()=>{class s{constructor(t,i,r,o,h){this.routerActive=t,this.translateService=i,this.baseService=r,this.alertService=o,this.ngxLoader=h,this.form={},this.selectedServices=[],this.notifier=new n.B,this.mainDelay=100,this.loaderSearchShap=f.cX,this.loaderOperationShap=f.$$,this.operationLoader=f.ZW,this.isEditForm=!1,this.showEdit=!1,this.serviceCategories=[],this.services=[],this.currentLang=this.translateService.currentLang,this.subtotal=0,this.total=0,this.serverImage=m.c.mediaUrl,this.filteredServices=[],this.seviceCount=0,this.serviceSelected=[],this.CalcTotal=new e.bkB,this.isOrderEdit=!0,this.responsiveOptions=[{breakpoint:"1400px",numVisible:4,numScroll:3},{breakpoint:"1220px",numVisible:4,numScroll:2},{breakpoint:"1100px",numVisible:4,numScroll:1}]}ngOnDestroy(){this.notifier.next(),this.notifier.complete()}ngOnInit(){this.getServicesByCategory(),this.checkCategorySelected()}checkCategorySelected(){this.serviceCategories.forEach(t=>{t.isSelected=this.form.serviceCategoryCode.includes(t.id)})}addService(t){const i=this.form.orderServices.findIndex(r=>r.serviceCode===t.code);i>-1?this.form.orderServices.splice(i,1):this.form.orderServices.push({serviceName:t.name,serviceCode:t.code,quantity:t.quantity,price:t.price*t.quantity,notes:t.notes,timeCount:t.timeCount}),this.checkTotal(),this.resetServiceForm()}updatePrice(t){this.form.orderServices.find(r=>r.serviceCode===t.code).price=t.price*t.quantity}checkTotal(){this.CalcTotal.next(!0)}deleteService(t){this.form.orderServices.splice(t,1)}deletePayment(t){this.form.orderPayments.splice(t,1)}resetServiceForm(){let t=this.form.formServices;t.serviceCode=void 0,t.price=null,t.notes=null}resetPaymentForm(){let t=this.form.formPayment;t.paymentTypeCode=null,t.value=null,t.attachRecietPath=null,t.fileName=null}configRoute(){this.routerActive.data.pipe((0,b.Q)(this.notifier)).subscribe(t=>{let i=t.data.data;i&&(this.isEditForm=!0,this.form=i,"Proposed"==i.leadsTypes?this.form.leadsTypes=1:"Inquiry"==i.leadsTypes&&(this.form.leadsTypes=2))},()=>{this.alertService.error()})}getServicesByCategory(){let t=this.form.serviceCategoryCode;return t.length<=0?(this.services=[],this.filteredServices=[],0):(this.ngxLoader.startLoader("order"),this.baseService.getServicesByCategory(t).subscribe(i=>{this.ngxLoader.stopLoader("order"),this.services=i.data,this.filteredServices=this.services,this.checkSelected()},i=>{this.ngxLoader.stopLoader("order"),console.log(i)}),1)}checkSelected(){this.form.orderServices.forEach(t=>{let i=this.filteredServices.find(r=>r.code===t.serviceCode);i&&(i.isSelected=!0)})}getTranslationText(t){let i="";return this.translateService.get(t).pipe((0,b.Q)(this.notifier)).subscribe(r=>{i=r}),i}onTimeSelected(t){this.form.orderTeams=t,console.log(t)}chooseCategory(t){if(!this.isOrderEdit)return;let i=this.serviceCategories.find(r=>r.id===t.id);if(i.isSelected=!i.isSelected,i.isSelected)this.form.serviceCategoryCode.push(t.id);else{let r=this.serviceCategories.findIndex(o=>o.id===t.id);-1!==r&&this.form.serviceCategoryCode.splice(r,1)}this.getServicesByCategory()}onServiceChange(t,i){if(!this.isOrderEdit)return;i.stopPropagation();const r=this.filteredServices.find(o=>o.code===t);r&&(r.isSelected=!r.isSelected),this.seviceCount=this.filteredServices.filter(o=>o.isSelected).length,this.addService(r)}btnPlus(t,i){i.stopPropagation();const r=this.filteredServices.find(o=>o.code===t);r&&(r.quantity++,this.checkTotal())}btnMinus(t,i){i.stopPropagation();const r=this.filteredServices.find(o=>o.code===t);r&&r.quantity>1?r.quantity-=1:r.quantity=1,this.checkTotal()}searchChange(t){const i=t.target.value.toLowerCase();this.filteredServices=""===i?[...this.services]:this.services.filter(r=>r.name.toLowerCase().includes(i))}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(G.nX),e.rXU(C.c$),e.rXU(T.Q),e.rXU(O.u),e.rXU(l.eD))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-order-services"]],inputs:{form:"form",serviceCategories:"serviceCategories",isOrderEdit:"isOrderEdit"},outputs:{CalcTotal:"CalcTotal"},decls:23,vars:18,consts:[[1,"service-container"],[1,"mt-2"],[1,"mb-0"],[3,"circular","value","numVisible","numScroll","rtl","responsiveOptions"],["pTemplate","item"],[1,"row","justify-content-between","align-items-center"],[1,"col-12","col-md-5"],[1,"mb-0","d-inline-block","position-relative"],["class","badge bg-primary mx-1",4,"ngIf"],[1,"col-12","col-md-5","mx-5"],[1,"search-box"],["type","search","id","filterValue","name","filterValue",1,"form-control","search","bg-light","border-light",3,"change","placeholder"],[1,"ri-search-line","search-icon"],["class","d-flex justify-content-center",4,"ngIf"],[1,"mt-3","row","row-cols-3"],[4,"ngFor","ngForOf"],[1,"border-1","surface-border","border-round","m-2","p-3"],[1,"card",2,"max-width","194px!important","border-radius","15px !important","cursor","pointer","box-shadow","0px 0px 15px 0px #00000026 !important",3,"click","ngClass","id"],[1,"card-body","text-center"],["height","50","onerror","this.onerror=null;this.src='assets/images/custom/no-img.jpg';",1,"rounded",3,"width","src"],[1,"d-block","mt-2",2,"font-size",".9rem !important","min-height","55px","font-weight","500 !important","line-height","27.2px !important"],[1,"badge","bg-primary","mx-1"],[1,"d-flex","justify-content-center"],["type","button","translate","orderManagement.order.noCategoryMessage",1,"btn","btn-sm","my-2","btn-danger","fs-4","mb-3"],[1,"col-12","col-md-3","text-center","ribbon-box","material-shadow"],[1,"btn-group","w-100"],["tooltipPosition","top",1,"ribbon","round-shape",3,"pTooltip","ngClass"],["type","checkbox",1,"btn-check",3,"change","value","id","checked"],[1,"w-100",3,"for"],[1,"card","card-service","card-body",3,"ngClass"],[1,"position-absolute","start-0",2,"z-index","0"],["version","1.2","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 200 120","width","90","height","120"],["id","Shape 8","d","m189.5-25.8c0 0 20.1 46.2-26.7 71.4 0 0-60 15.4-62.3 65.3-2.2 49.8-50.6 59.3-57.8 61.5-7.2 2.3-60.8 0-60.8 0l-11.9-199.4z",1,"s0"],[1,"w-100"],["height","80","onerror","this.onerror=null;this.src='assets/images/custom/no-img.jpg';",1,"avatar-sm","rounded-circle",3,"width","src"],[1,"ms-2","my-2"],[1,"card-title","mb-1"],[1,"mb-1"],[1,"input-step","my-2"],["type","button",1,"minus",3,"click","disabled"],["type","number","min","0","max","100",1,"product-quantity",3,"disabled","id","value"],["type","button",1,"plus",3,"click","disabled"]],template:function(i,r){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"h4",2),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"bdi")(6,"p-carousel",3),e.DNE(7,Ce,6,8,"ng-template",4),e.k0s()()(),e.j41(8,"div")(9,"div",5)(10,"div",6)(11,"h4",7),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.DNE(14,ye,2,1,"span",8),e.k0s(),e.j41(15,"div",9)(16,"div",10)(17,"input",11),e.nI1(18,"translate"),e.bIt("change",function(h){return r.searchChange(h)}),e.k0s(),e.nrm(19,"i",12),e.k0s()()(),e.DNE(20,Se,2,0,"div",13),e.j41(21,"div",14),e.DNE(22,Te,28,30,"ng-container",15),e.k0s()()()),2&i&&(e.R7$(3),e.JRh(e.bMT(4,12,"orderManagement.order.serviceCategory")),e.R7$(3),e.Y8G("circular",!0)("value",r.serviceCategories)("numVisible",4)("numScroll",1)("rtl",!1)("responsiveOptions",r.responsiveOptions),e.R7$(6),e.JRh(e.bMT(13,14,"orderManagement.order.selectedServices")),e.R7$(2),e.Y8G("ngIf",r.seviceCount>0),e.R7$(3),e.FS9("placeholder",e.bMT(18,16,"orderManagement.order.searchService")),e.R7$(3),e.Y8G("ngIf",0==r.filteredServices.length),e.R7$(2),e.Y8G("ngForOf",r.filteredServices))},dependencies:[_.YU,_.Sq,_.bT,ge.F,ue.Ei,C.Mm,fe.m,C.D9],encapsulation:2})}}return s})();const Me=(s,g)=>({"border-right: solid #E5E5E6 2px":s,"border-left: solid #E5E5E6 2px":g}),Ie=s=>({"border-bottom:1px solid #E5E5E6;":s});function xe(s,g){if(1&s){const t=e.RV6();e.j41(0,"app-client-info",39),e.bIt("calacTotal",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.checkTotal())})("setFormByOrderCode",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.setFormByOrderCode(r))}),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("isOrderEdit",t.isOrderEdit)("isInner",t.isInner)("orderTypes",t.orderTypes)("channels",t.channels)("cities",t.cities)("form",t.form)}}function je(s,g){if(1&s&&e.nrm(0,"client-location",40),2&s){const t=e.XpG();e.Y8G("isOrderEdit",t.isOrderEdit)("form",t.form)}}function ke(s,g){if(1&s){const t=e.RV6();e.j41(0,"app-order-services",41),e.bIt("CalcTotal",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.checkTotal())}),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("isOrderEdit",t.isOrderEdit)("serviceCategories",t.serviceCategories)("form",t.form)}}function Fe(s,g){if(1&s){const t=e.RV6();e.j41(0,"time-available",42),e.bIt("onTimeSelected",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onTimeSelected(r))}),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("isOrderOpenOrder",!0)("isReopen",t.isReopen)("dataVisit",t.form.visitDate)("isOrderEdit",t.isOrderEdit)("categoryId",t.form.serviceCategoryCode)("orderSelected",t.form.orderTeams)("cityId",t.form.cityCode)("isShowFilter",!1)}}function Ee(s,g){if(1&s){const t=e.RV6();e.j41(0,"app-order-payment",43),e.bIt("CalcTotal",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.checkTotal())})("finishedUpdateOrder",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.finishedUpdateOrder(r))})("finishedOrder",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.finishedOrder(r))}),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("isOrderEdit",t.isOrderEdit)("paymentTypes",t.paymentTypes)("form",t.form)}}function Re(s,g){if(1&s){const t=e.RV6();e.j41(0,"app-finish-order",45),e.bIt("newOrder",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.newOrder())}),e.k0s()}if(2&s){const t=e.XpG(2);e.Y8G("orderCode",t.orderCode)("form",t.form)}}function Le(s,g){1&s&&(e.j41(0,"li",13)(1,"a",14),e.nrm(2,"i",44),e.j41(3,"span",16),e.EFF(4),e.nI1(5,"translate"),e.k0s()(),e.DNE(6,Re,1,2,"ng-template",17),e.k0s()),2&s&&(e.Y8G("ngbNavItem",6),e.R7$(4),e.SpI(" ",e.bMT(5,2,"orderManagement.order.finish")," "))}function Ge(s,g){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"tr",48)(2,"td",49)(3,"div",50)(4,"div",51)(5,"span",52),e.EFF(6),e.k0s(),e.EFF(7),e.k0s(),e.j41(8,"div",53)(9,"div",54)(10,"button",55),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.decrement(r))}),e.EFF(11,"\u2013 "),e.k0s(),e.j41(12,"input",56),e.bIt("change",function(r){const o=e.eBV(t).$implicit,h=e.XpG(2);return e.Njj(h.quantityChange(r,o))}),e.k0s(),e.j41(13,"button",57),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.increment(r))}),e.EFF(14,"+ "),e.k0s()()(),e.j41(15,"div",58),e.EFF(16),e.nI1(17,"translate"),e.j41(18,"i",59),e.bIt("click",function(){const r=e.eBV(t).index,o=e.XpG(2);return o.removeService(r),e.Njj(o.checkTotal())}),e.k0s()()()()(),e.bVm()}if(2&s){const t=g.$implicit,i=g.index,r=e.XpG(2);e.R7$(),e.Y8G("ngStyle",e.eq3(10,Ie,i===r.form.orderServices.length-1)),e.R7$(5),e.JRh(i+1),e.R7$(),e.SpI(" ",t.serviceName," "),e.R7$(5),e.Mz_("id","cart-",t.code,""),e.FS9("value",t.quantity),e.R7$(4),e.Lme(" ",t.price," ",e.bMT(17,8,"orderManagement.order.currancy")," ")}}function De(s,g){if(1&s&&(e.qex(0),e.j41(1,"h5",46),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,Ge,19,12,"ng-container",47),e.bVm()),2&s){const t=e.XpG();e.R7$(2),e.SpI(" ",e.bMT(3,2,"orderManagement.order.clientServices")," "),e.R7$(2),e.Y8G("ngForOf",t.form.orderServices)}}function Ne(s,g){1&s&&(e.j41(0,"tr")(1,"td",60),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"orderManagement.order.noServices")," "))}function Ae(s,g){1&s&&(e.j41(0,"tr")(1,"td",61),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"td",62),e.EFF(5," 0 "),e.k0s()()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"orderManagement.order.ServicePrice")," "))}let Be=(()=>{class s{constructor(t,i,r,o){this.translateService=t,this.baseService=i,this.alertService=r,this.ngxLoader=o,this.editOrders="orderManagement.order.editOrders",this.addOrders="orderManagement.order.addOrders",this.titleOperation="orderManagement.order.titleOperation",this.keySelected="",this.active=1,this.language=this.translateService.currentLang,this.searchForm="",this.breadCrumbItems=[],this.form={orderCode:null,cityCode:0,isUrgent:!1,discountAmount:0,total:0,serviceCategoryCode:[],formServices:{serviceCode:null,price:null,notes:null},formPayment:{paymentTypeCode:null,value:null,attachRecietPath:"",fileName:""},agent:{},orderTeams:[],orderPayments:[],orderLocations:{},orderServices:[]},this.orderCode=0,this.mobile=0,this.cityCode=0,this.agentName="",this.pendingCode=0,this.isInner=!1,this.isOrderEdit=!0,this.idForm=0,this.totalPaid=0,this.priceModel=0,this.priceModelIndex=0,this.subtotal=0,this.paidTotal=0,this.VATTotal=0,this.total=0,this.isResolveList=!0,this.extraDiscountCalc=!1,this.employeeGroups=[],this.notifier=new n.B,this.mainDelay=100,this.loaderSearchShap=f.cX,this.loaderOperationShap=f.$$,this.operationLoader=f.ZW,this.isEditForm=!1,this.showEdit=!1,this.channels=[],this.districts=[],this.cities=[],this.orderTypes=[],this.serviceCategories=[],this.services=[],this.paymentTypes=[],this.isFinished=!1,this.isUpdate=!1,this.isReopen=!1}OpenChangInput(t,i){this.showEdit=!0,this.priceModel=i.price,this.priceModelIndex=t}ChangInput(){this.form.orderServices[`${this.priceModelIndex}`].price=this.priceModel,this.showEdit=!1}ngOnDestroy(){this.notifier.next(),this.notifier.complete()}ngOnInit(){this.resetForm(),this.breadCrumbItems=[{label:"layout.sidebar.orders"},{label:"orderManagement.order.title",active:!0,url:"order/list"},{label:this.isEditForm?"general.action.edit":"general.action.register",active:!0}],this.GetOrderLookUp(),this.checkTotal()}GetOrderLookUp(){this.baseService.GetOrderLookUp().subscribe(t=>{this.channels=t.data.channels,this.cities=t.data.cityNames,this.orderTypes=t.data.orderStatus,this.serviceCategories=t.data.serviceCategories,this.paymentTypes=t.data.paymentTypes},t=>{console.log(t)})}getDistricts(t){this.ngxLoader.startLoader(f.ZW),this.baseService.districtsByCity(t).subscribe(i=>{this.districts=i.data,this.ngxLoader.stopLoader(f.ZW)},i=>{console.log(i)})}getTranslationText(t){let i="";return this.translateService.get(t).pipe((0,b.Q)(this.notifier)).subscribe(r=>{i=r}),i}checkTotal(){this.subtotal=this.form.orderServices.reduce((i,r)=>i+(r.price*r.quantity||0),0),this.VATTotal=0==this.subtotal?0:this.subtotal+.15*this.subtotal,this.paidTotal=this.form.orderPayments.reduce((i,r)=>i+(r.value||0),0),this.form.total=this.total=this.VATTotal-(+this.form.discountAmount||0)}setFormByOrderCode(t){this.form=t,this.checkTotal()}onTimeSelected(t){this.form.orderTeams=t,console.log(t)}onNavChange(t){if(2===t.nextId&&!this.form.agent.mobile&&!this.form.agent.agentName&&!this.form.agent.cityCode&&(this.alertService.error("orderManagement.order.mustSelectClientInfo"),t.preventDefault()),3===t.nextId)this.form.orderLocations.length<=0&&(this.alertService.error("orderManagement.order.mustSelectOrderLocations"),t.preventDefault());else if(4===t.nextId)this.form.orderServices.length<=0?(this.alertService.error("orderManagement.order.mustSelectServices"),t.preventDefault()):this.form.cityCode||(this.alertService.error("orderManagement.order.mustSelectClientInfo"),t.preventDefault());else if(5===t.nextId){const i=this.form.orderServices.reduce((r,o)=>r+ +o.timeCount,0);this.form.orderTeams.length<=0&&(this.alertService.error("orderManagement.order.mustSelectTimes"),t.preventDefault()),i!=this.form.orderTeams.length&&(this.alertService.error("orderManagement.order.mustSelectServiceTime"),t.preventDefault())}else 6===t.nextId&&(this.isFinished||t.preventDefault())}changeTab(){}finishedOrder(t){this.isFinished=!0,this.orderCode=t,this.active=6,this.resetForm()}finishedUpdateOrder(t){this.isFinished=!0,this.orderCode=t,this.active=6}newOrder(){this.resetForm(),this.orderCode=0,this.active=1,this.total=0,this.subtotal=0}resetForm(){this.form={orderCode:this.orderCode,pendingCode:this.pendingCode,discountAmount:0,total:0,serviceCategoryCode:[],formServices:{serviceCode:null,price:null,notes:null},formPayment:{paymentTypeCode:null,value:null,attachRecietPath:"",fileName:""},agent:{mobile:this.mobile,agentName:this.agentName,cityCode:this.cityCode},orderTeams:[],orderPayments:[],orderLocations:[],orderServices:[]}}removeService(t){this.form.orderServices.splice(t,1)}updatePrice(t,i){this.form.orderServices[i].price=t.price*t.quantity}decrement(t){let i=this.form.orderServices.find(r=>r.serviceCode==t.serviceCode);i.quantity<=1||(i&&(i.quantity=i.quantity-1),this.checkTotal())}increment(t){let i=this.form.orderServices.find(r=>r.serviceCode==t.serviceCode);i&&(i.quantity=i.quantity+1),this.checkTotal()}quantityChange(t,i){parseInt(t.target.value)<=0&&(this.form.orderServices.find(h=>h.serviceCode==i.serviceCode).quantity=1),this.checkTotal(),this.form.orderServices=[...this.form.orderServices]}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(C.c$),e.rXU(T.Q),e.rXU(O.u),e.rXU(l.eD))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["order-operation"]],inputs:{form:"form",orderCode:"orderCode",mobile:"mobile",cityCode:"cityCode",agentName:"agentName",pendingCode:"pendingCode",isInner:"isInner",isOrderEdit:"isOrderEdit",isReopen:"isReopen"},decls:113,vars:76,consts:[["formEntity","ngForm"],["customNav","ngbNav"],["discountAmount","ngModel"],[1,"row"],[1,"col-xl-12"],[1,"checkout-tab"],[1,"col-12","col-lg-8","col-md-12",3,"ngStyle"],[1,"card","card-summary","card-order-operation","m-0","ribbon-box","material-shadow",2,"border-radius","20px"],[1,"card-body",2,"padding","2rem"],[1,"ribbon-three","ribbon-three-success"],["fgsColor","rgba(255,255,255,0)",3,"loaderId"],[1,"step-arrow-nav","mt-n3","mx-n3","mb-3"],["ngbNav","","role","tablist",1,"nav","nav-pills","custom-nav","nav-justified",3,"navChange","activeId"],[3,"ngbNavItem"],["ngbNavLink","","data-bs-toggle","tab","role","tab",1,"nav-link","fs-15","p-3"],[1,"ri-user-3-fill","fs-16","p-2","bg-primary-subtle","text-primary","rounded-circle","align-middle","mx-2"],[1,"d-block","mt-2"],["ngbNavContent",""],[1,"ri-user-location-fill","fs-16","p-2","bg-primary-subtle","text-primary","rounded-circle","align-middle","mx-2"],[1,"ri-shopping-cart-fill","fs-16","p-2","bg-primary-subtle","text-primary","rounded-circle","align-middle","mx-2"],[1,"ri-alarm-line","fs-16","p-2","bg-primary-subtle","text-primary","rounded-circle","align-middle","mx-2"],[1,"ri-money-dollar-box-fill","fs-16","p-2","bg-primary-subtle","text-primary","rounded-circle","align-middle","mx-2"],[3,"ngbNavItem",4,"ngIf"],[1,"tab-content"],[3,"ngbNavOutlet"],[1,"col-12","col-lg-4","col-md-12","mt-3","mt-lg-0","mt-md-3","mb-3","summary"],[1,"card","card-summary","card-summary-pos","card-order-operation","m-0","ribbon-box","material-shadow"],[1,"table-responsive","table-card","mt-3","overflow-hidden"],[1,"table","table-borderless","align-middle","mb-0"],[4,"ngIf"],[2,"border-top","hsl(226, 36%, 80%) solid 1px!important"],["colspan","2",1,"fw-semibold"],[1,"fw-semibold","text-end"],["colspan","2"],["InputTirmFilter","","name","discountAmount","type","text","id","discountAmount","required","",1,"100","form-control","text-right",3,"change","ngModelChange","ngModel"],[1,"table-active","py-1"],[1,"text-end"],[1,"fw-semibold"],[1,"table-active","text-danger","py-1"],[3,"calacTotal","setFormByOrderCode","isOrderEdit","isInner","orderTypes","channels","cities","form"],[3,"isOrderEdit","form"],[3,"CalcTotal","isOrderEdit","serviceCategories","form"],[3,"onTimeSelected","isOrderOpenOrder","isReopen","dataVisit","isOrderEdit","categoryId","orderSelected","cityId","isShowFilter"],[3,"CalcTotal","finishedUpdateOrder","finishedOrder","isOrderEdit","paymentTypes","form"],[1,"ri-check-double-fill","fs-16","p-2","bg-primary-subtle","text-primary","rounded-circle","align-middle","mx-2"],[3,"newOrder","orderCode","form"],[1,"text-start","text-muted","fw-semibold","mt-3"],[4,"ngFor","ngForOf"],[3,"ngStyle"],["colspan","3",1,"p-1","m-1"],[1,"row","justify-content-between","align-items-center"],[1,"col-12","col-md-4","h6"],[1,"badge","bg-success-subtle","text-success"],[1,"col-12","col-md-4","text-mute","text-center"],[1,"input-step","my-2"],["type","button",1,"minus",3,"click"],["disabled","","type","number","min","1","max","100",1,"product-quantity",3,"change","id","value"],["type","button",1,"plus",3,"click"],[1,"col-12","col-md-4","text-mute","text-right"],[1,"ri-close-fill","text-danger","cursor-pointer",3,"click"],["colspan","3",1,"text-center","text-danger"],[1,"text-start","text-muted","fw-semibold"],["colspan","2",1,"text-end"]],template:function(i,r){if(1&i){const o=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"div")(3,"div",5)(4,"div",3)(5,"div",6)(6,"div",7)(7,"div",8)(8,"span",9)(9,"span"),e.EFF(10),e.nI1(11,"translate"),e.k0s()(),e.nrm(12,"ngx-ui-loader",10),e.j41(13,"div",11)(14,"form",null,0)(16,"ul",12,1),e.bIt("navChange",function(u){return e.eBV(o),e.Njj(r.onNavChange(u))}),e.j41(18,"li",13)(19,"a",14),e.nrm(20,"i",15),e.j41(21,"span",16),e.EFF(22),e.nI1(23,"translate"),e.k0s()(),e.DNE(24,xe,1,6,"ng-template",17),e.k0s(),e.j41(25,"li",13)(26,"a",14),e.nrm(27,"i",18),e.j41(28,"span",16),e.EFF(29),e.nI1(30,"translate"),e.k0s()(),e.DNE(31,je,1,2,"ng-template",17),e.k0s(),e.j41(32,"li",13)(33,"a",14),e.nrm(34,"i",19),e.j41(35,"span",16),e.EFF(36),e.nI1(37,"translate"),e.k0s()(),e.DNE(38,ke,1,3,"ng-template",17),e.k0s(),e.j41(39,"li",13)(40,"a",14),e.nrm(41,"i",20),e.j41(42,"span",16),e.EFF(43),e.nI1(44,"translate"),e.k0s()(),e.DNE(45,Fe,1,8,"ng-template",17),e.k0s(),e.j41(46,"li",13)(47,"a",14),e.nrm(48,"i",21),e.j41(49,"span",16),e.EFF(50),e.nI1(51,"translate"),e.k0s()(),e.DNE(52,Ee,1,3,"ng-template",17),e.k0s(),e.DNE(53,Le,7,4,"li",22),e.k0s(),e.j41(54,"div",23),e.nrm(55,"div",24),e.k0s()()()()()(),e.j41(56,"div",25)(57,"div",26)(58,"div",8)(59,"span",9)(60,"span"),e.EFF(61),e.nI1(62,"translate"),e.k0s()(),e.j41(63,"div",27)(64,"table",28)(65,"tbody"),e.DNE(66,De,5,4,"ng-container",29)(67,Ne,4,3,"tr",29)(68,Ae,6,3,"tr",29),e.j41(69,"tr",30)(70,"td",31),e.EFF(71),e.nI1(72,"translate"),e.k0s(),e.j41(73,"td",32),e.EFF(74),e.nI1(75,"translate"),e.k0s()(),e.j41(76,"tr",30)(77,"td",31),e.EFF(78),e.nI1(79,"translate"),e.k0s(),e.j41(80,"td",32),e.EFF(81),e.nI1(82,"translate"),e.k0s()(),e.j41(83,"tr",30)(84,"td",31),e.EFF(85),e.nI1(86,"translate"),e.k0s(),e.j41(87,"td",32),e.EFF(88),e.nI1(89,"translate"),e.k0s()(),e.j41(90,"tr")(91,"td",33),e.EFF(92),e.nI1(93,"translate"),e.k0s(),e.j41(94,"td")(95,"input",34,2),e.bIt("change",function(){return e.eBV(o),e.Njj(r.checkTotal())}),e.mxI("ngModelChange",function(u){return e.eBV(o),e.DH7(r.form.discountAmount,u)||(r.form.discountAmount=u),e.Njj(u)}),e.k0s()()(),e.j41(97,"tr",35)(98,"th",33),e.EFF(99),e.nI1(100,"translate"),e.k0s(),e.j41(101,"td",36)(102,"span",37),e.EFF(103),e.nI1(104,"translate"),e.k0s()()(),e.j41(105,"tr",38)(106,"th",33),e.EFF(107),e.nI1(108,"translate"),e.k0s(),e.j41(109,"td",36)(110,"span",37),e.EFF(111),e.nI1(112,"translate"),e.k0s()()()()()()()()()()()()()()}if(2&i){const o=e.sdS(17);e.R7$(5),e.Y8G("ngStyle",e.l_i(73,Me,"en"==r.language,"en"==r.language)),e.R7$(5),e.JRh(e.bMT(11,37,"orderManagement.order.addOrders")),e.R7$(2),e.Y8G("loaderId","order"),e.R7$(4),e.Y8G("activeId",r.active),e.R7$(2),e.Y8G("ngbNavItem",1),e.R7$(4),e.SpI(" ",e.bMT(23,39,"orderManagement.order.clientInfo")," "),e.R7$(3),e.Y8G("ngbNavItem",2),e.R7$(4),e.SpI(" ",e.bMT(30,41,"orderManagement.order.locations")," "),e.R7$(3),e.Y8G("ngbNavItem",3),e.R7$(4),e.SpI(" ",e.bMT(37,43,"orderManagement.order.services")," "),e.R7$(3),e.Y8G("ngbNavItem",4),e.R7$(4),e.SpI(" ",e.bMT(44,45,"orderManagement.order.timesNav")," "),e.R7$(3),e.Y8G("ngbNavItem",5),e.R7$(4),e.SpI(" ",e.bMT(51,47,"orderManagement.order.paid")," "),e.R7$(3),e.Y8G("ngIf",r.isOrderEdit),e.R7$(2),e.Y8G("ngbNavOutlet",o),e.R7$(6),e.JRh(e.bMT(62,49,"orderManagement.order.orderSummary")),e.R7$(5),e.Y8G("ngIf",r.form.orderServices.length>0),e.R7$(),e.Y8G("ngIf",0==r.form.orderServices.length),e.R7$(),e.Y8G("ngIf",0==r.form.orderServices.length),e.R7$(3),e.SpI("",e.bMT(72,51,"orderManagement.order.SubTotal"),": "),e.R7$(3),e.Lme("",r.subtotal," ",e.bMT(75,53,"orderManagement.order.currancy"),""),e.R7$(4),e.SpI("",e.bMT(79,55,"orderManagement.order.paidTotal"),": "),e.R7$(3),e.Lme("",r.paidTotal," ",e.bMT(82,57,"orderManagement.order.currancy"),""),e.R7$(4),e.SpI("",e.bMT(86,59,"orderManagement.order.VAT"),": "),e.R7$(3),e.Lme("",r.VATTotal," ",e.bMT(89,61,"orderManagement.order.currancy"),""),e.R7$(4),e.SpI("",e.bMT(93,63,"orderManagement.order.Discount"),":"),e.R7$(3),e.R50("ngModel",r.form.discountAmount),e.R7$(4),e.SpI("",e.bMT(100,65,"orderManagement.order.Total")," :"),e.R7$(4),e.Lme(" ",r.total," ",e.bMT(104,67,"orderManagement.order.currancy")," "),e.R7$(4),e.SpI("",e.bMT(108,69,"orderManagement.order.reminder")," :"),e.R7$(4),e.Lme(" ",r.total-r.paidTotal," ",e.bMT(112,71,"orderManagement.order.currancy")," ")}},dependencies:[_.Sq,_.bT,_.B3,M.Um,M.X9,M.sy,M.Gx,M.Ri,M.WA,M.m_,v.qT,v.me,v.BC,v.cb,v.YS,v.vS,v.cV,R.m,l.Cv,U.h,X,te,re,he,Oe,C.D9],encapsulation:2})}}return s})()},80388:(B,x,d)=>{d.d(x,{h:()=>W});var n=d(54438),b=d(21413),f=d(56977),e=d(3888),C=d(33826),T=d(60177),O=d(8147),l=d(1530),_=d(89417),M=d(72510),v=d(91022);const R=(m,y)=>({"btn-outline-success":m,"btn-outline-danger":y});function U(m,y){if(1&m){const a=n.RV6();n.j41(0,"div",15)(1,"div",16),n.nrm(2,"label",17),n.j41(3,"div",18)(4,"ng-select",19),n.bIt("change",function(){n.eBV(a);const c=n.XpG();return n.Njj(c.getChange())}),n.mxI("ngModelChange",function(c){n.eBV(a);const S=n.XpG();return n.DH7(S.cityId,c)||(S.cityId=c),n.Njj(c)}),n.k0s()()(),n.j41(5,"div",20),n.nrm(6,"label",21),n.j41(7,"div",18)(8,"ng-select",22),n.bIt("change",function(){n.eBV(a);const c=n.XpG();return n.Njj(c.getChange())}),n.mxI("ngModelChange",function(c){n.eBV(a);const S=n.XpG();return n.DH7(S.categoryId,c)||(S.categoryId=c),n.Njj(c)}),n.k0s()()()()}if(2&m){const a=n.XpG();n.R7$(4),n.R50("ngModel",a.cityId),n.Y8G("items",a.cities)("multiple",!1),n.R7$(4),n.R50("ngModel",a.categoryId),n.Y8G("items",a.categories)("multiple",!0)}}function D(m,y){if(1&m){const a=n.RV6();n.j41(0,"button",23),n.bIt("click",function(){n.eBV(a);const c=n.XpG();return n.Njj(c.goNext())}),n.nrm(1,"i",24)(2,"span",25),n.k0s()}if(2&m){const a=n.XpG();n.Y8G("disabled",!a.isOrderEdit)}}function L(m,y){if(1&m){const a=n.RV6();n.j41(0,"button",23),n.bIt("click",function(){n.eBV(a);const c=n.XpG();return n.Njj(c.goBack())}),n.nrm(1,"i",26)(2,"span",27),n.k0s()}if(2&m){const a=n.XpG();n.Y8G("disabled",!a.isOrderEdit)}}function P(m,y){if(1&m){const a=n.RV6();n.j41(0,"button",23),n.bIt("click",function(){n.eBV(a);const c=n.XpG();return n.Njj(c.goBack())}),n.nrm(1,"span",27)(2,"i",26),n.k0s()}if(2&m){const a=n.XpG();n.Y8G("disabled",!a.isOrderEdit)}}function $(m,y){if(1&m){const a=n.RV6();n.j41(0,"button",23),n.bIt("click",function(){n.eBV(a);const c=n.XpG();return n.Njj(c.goNext())}),n.nrm(1,"span",25)(2,"i",24),n.k0s()}if(2&m){const a=n.XpG();n.Y8G("disabled",!a.isOrderEdit)}}function V(m,y){if(1&m&&(n.qex(0),n.j41(1,"th",38),n.EFF(2),n.k0s(),n.bVm()),2&m){const a=y.$implicit;n.R7$(2),n.SpI(" ",a.teamName," ")}}function w(m,y){if(1&m&&(n.qex(0),n.j41(1,"span",40),n.EFF(2),n.k0s(),n.nrm(3,"br"),n.j41(4,"span",41),n.EFF(5),n.k0s(),n.bVm()),2&m){const a=n.XpG(2).$implicit;n.R7$(2),n.JRh(a.serviceName),n.R7$(3),n.JRh(a.orderId)}}function X(m,y){1&m&&(n.qex(0),n.nrm(1,"span",42)(2,"br"),n.bVm())}function j(m,y){if(1&m&&(n.qex(0),n.j41(1,"td"),n.DNE(2,w,6,2,"ng-container",39)(3,X,3,0,"ng-container",39),n.k0s(),n.bVm()),2&m){const a=n.XpG().$implicit;n.R7$(2),n.Y8G("ngIf",!a.isHoliday),n.R7$(),n.Y8G("ngIf",a.isHoliday)}}function k(m,y){1&m&&n.nrm(0,"span",48)}function F(m,y){1&m&&n.nrm(0,"span",49)}function I(m,y){if(1&m){const a=n.RV6();n.qex(0),n.j41(1,"td")(2,"div",43)(3,"input",44),n.bIt("change",function(){n.eBV(a);const c=n.XpG(4);return n.Njj(c.onTimeAvaliables())}),n.mxI("ngModelChange",function(c){n.eBV(a);const S=n.XpG().$implicit;return n.DH7(S.isSelected,c)||(S.isSelected=c),n.Njj(c)}),n.k0s(),n.j41(4,"label",45),n.DNE(5,k,1,0,"span",46)(6,F,1,0,"span",47),n.k0s()()(),n.bVm()}if(2&m){const a=n.XpG().$implicit,p=n.XpG(3);n.R7$(3),n.Y8G("disabled",!p.isOrderEdit),n.R50("ngModel",a.isSelected),n.Y8G("id",a.id),n.R7$(),n.FS9("for",a.id),n.Y8G("ngClass",n.l_i(7,R,a.isSelected,!a.isSelected)),n.R7$(),n.Y8G("ngIf",a.isSelected),n.R7$(),n.Y8G("ngIf",!a.isSelected)}}function N(m,y){if(1&m&&(n.qex(0),n.DNE(1,j,4,2,"ng-container",39)(2,I,7,10,"ng-container",39),n.bVm()),2&m){const a=y.$implicit;n.R7$(),n.Y8G("ngIf",!a.isAvaliable),n.R7$(),n.Y8G("ngIf",a.isAvaliable)}}function A(m,y){if(1&m&&(n.qex(0),n.j41(1,"tr")(2,"td"),n.EFF(3),n.k0s(),n.DNE(4,N,3,2,"ng-container",37),n.k0s(),n.bVm()),2&m){const a=y.$implicit;n.R7$(3),n.JRh(a.diaplayName),n.R7$(),n.Y8G("ngForOf",a.availableTimes)}}function Y(m,y){if(1&m&&(n.j41(0,"div",28)(1,"div",29)(2,"div",30),n.nrm(3,"ngx-ui-loader",31),n.j41(4,"div",32)(5,"div",33)(6,"table",34)(7,"thead",35)(8,"tr"),n.nrm(9,"th",36),n.DNE(10,V,3,1,"ng-container",37),n.k0s()(),n.j41(11,"tbody"),n.DNE(12,A,5,2,"ng-container",37),n.k0s()()()()()()()),2&m){const a=n.XpG();n.R7$(3),n.Y8G("loaderId","timeAvailable"),n.R7$(7),n.Y8G("ngForOf",a.teams),n.R7$(2),n.Y8G("ngForOf",a.timesList)}}let W=(()=>{class m{constructor(a,p,c,S,E){this.alertService=a,this.orderService=p,this.datePipe=c,this.translateService=S,this.loader=E,this.title="orderManagement.timeAvailable.title",this.searchForm={date:new Date},this.cities=[],this.categories=[],this.dateCurrent=new Date,this.timesList=[],this.teams=[],this.onTimeSelected=new n.bkB,this.notifier=new b.B,this.isShowFilter=!0,this.dataVisit="",this.orderSelected=[],this.isFirst=!0,this.isOrderEdit=[],this.isReopen=!1,this.isOrderOpenOrder=!1}ngOnInit(){this.searchForm.date=null!=this.dataVisit&&""!=this.dataVisit?new Date(this.dataVisit):new Date,this.lang=this.translateService.currentLang,this.GetTimeAvailableLookup(),this.getTimeAvailables()}GetTimeAvailableLookup(){this.orderService.GetTimeAvailableLookup().pipe((0,f.Q)(this.notifier)).subscribe(a=>{this.cities=a.data.cities,this.categories=a.data.categories})}getChange(){setTimeout(()=>{this.getTimeAvailables()},50)}getTimeAvailables(){if(!this.validateForm())return;let p={};p.serviceCategoryId=this.categoryId,p.cityId=this.cityId,(""==this.dataVisit&&this.searchForm.date||null==this.dataVisit&&this.searchForm.date)&&(p.date=this.datePipe.transform(this.searchForm.date,"yyyy-MM-ddT00:00:00.000")),null!=this.dataVisit&&""!=this.dataVisit&&(p.date=this.dataVisit),this.loader.startLoader("timeAvailable"),this.orderService.GetAvailableTime(p).subscribe(c=>{this.loader.stopLoader("timeAvailable"),this.isFirst=!1,this.timesList=c.data.timesList,this.getOrderSelected(),this.teams=c.data.teams})}getOrderSelected(){console.log(this.orderSelected),this.orderSelected.length>0&&this.timesList.forEach(a=>{a.availableTimes.forEach(p=>{let c=this.orderSelected.find(S=>(S.orderCode===p.orderId||S.orderCode===p.orderCode)&&S.teamCode===p.teamId&&S.workTimeCode===p.timeId);(null!=c||null!=c)&&(this.isReopen?(p.isAvaliable=!0,p.isSelected=!1):p.isSelected=!0,p.orderTeamCode=c.orderTeamCode,p.orderCode=c.orderCode),p.isSelected&&(p.orderTeamCode=c.orderTeamCode,p.orderCode=c.orderCode,p.isAvaliable=p.isSelected),p.isOrderSelected=p.isSelected,console.log(p)})}),this.isReopen&&(this.orderSelected=[])}validateForm(){return this.cityId?this.categoryId?!!this.searchForm.date||(this.isFirst||this.alertService.error("orderManagement.timeAvailable.selectDate"),!1):(this.isFirst||this.alertService.error("orderManagement.timeAvailable.selectServiceCategory"),!1):(this.isFirst||this.alertService.error("orderManagement.timeAvailable.selectCity"),!1)}goBack(){this.searchForm.date=new Date(this.searchForm.date),this.searchForm.date.setDate(this.searchForm.date.getDate()-1);const a=new Date;a.setHours(0,0,0,0),this.searchForm.date.getTime()<a.getTime()?this.searchForm.date=a:this.getTimeAvailables()}goNext(){this.searchForm.date=new Date(this.searchForm.date),this.searchForm.date.setDate(this.searchForm.date.getDate()+1),this.getTimeAvailables()}onTimeAvaliables(){const a=this.timesList.flatMap(p=>p.availableTimes.filter(c=>c.isSelected).map(c=>({orderTeamCode:c.orderTeamCode||0,orderCode:c.orderCode||0,teamCode:c.teamId,workTimeCode:c.timeId})));this.onTimeSelected.emit(a)}ngOnDestroy(){this.notifier.next(),this.notifier.complete()}static{this.\u0275fac=function(p){return new(p||m)(n.rXU(e.u),n.rXU(C.Q),n.rXU(T.vh),n.rXU(O.c$),n.rXU(l.eD))}}static{this.\u0275cmp=n.VBU({type:m,selectors:[["time-available"]],inputs:{isShowFilter:"isShowFilter",cityId:"cityId",categoryId:"categoryId",dataVisit:"dataVisit",orderSelected:"orderSelected",isOrderEdit:"isOrderEdit",isReopen:"isReopen",isOrderOpenOrder:"isOrderOpenOrder"},outputs:{onTimeSelected:"onTimeSelected"},decls:17,vars:13,consts:[[1,"card","d-print-none"],[1,"card-body"],["class","row  justify-content-around  mb-2",4,"ngIf"],[1,"row","justify-content-center"],[1,"col-12","col-md-3"],["class","btn w-auto btn-sm btn-success fs-5",3,"disabled","click",4,"ngIf"],["class","btn  w-auto btn-sm btn-success fs-5",3,"disabled","click",4,"ngIf"],[1,"col-12","col-sm-6","col-md-4"],[1,"input-group"],["id","basic-addon1",1,"input-group-text","border","btn","btn-success",3,"click"],[1,"ri-calendar-line","align-bottom","me-1"],["type","text","mwlFlatpickr","","id","date","name","date",1,"form-control","bg-light","border-light","flatpickr-input","active",3,"change","ngModelChange","disabled","altInput","convertModelValue","placeholder","ngModel"],[1,"col-12","col-md-3","text-right"],["class","btn   w-auto  btn-sm btn-success fs-5",3,"disabled","click",4,"ngIf"],["class","row",4,"ngIf"],[1,"row","justify-content-around","mb-2"],[1,"col-12","col-md-4"],["translate","orderManagement.timeAvailable.city",1,"required"],[1,"search-box"],["id","cityId","name","cityId","bindValue","id","bindLabel","name",3,"change","ngModelChange","ngModel","items","multiple"],[1,"col-12","col-md-6"],["translate","orderManagement.timeAvailable.categories",1,"required"],["id","categoryId","name","categoryId","bindValue","id","bindLabel","name",3,"change","ngModelChange","ngModel","items","multiple"],[1,"btn","w-auto","btn-sm","btn-success","fs-5",3,"click","disabled"],[1,"ri-arrow-left-circle-line","mx-2"],["translate","orderManagement.timeAvailable.next"],[1,"ri-arrow-right-circle-line","mx-2"],["translate","orderManagement.timeAvailable.back"],[1,"row"],[1,"col-12"],[1,"card"],["fgsColor","rgba(255,255,255,0)",3,"loaderId"],["id","printTable",1,"card-body"],[1,"table-responsive","table-card"],[1,"table","table-border","text-center","table-hover","table-centered","align-middle","table-nowrap","mb-0"],[1,"text-muted","border","table-light"],["translate","orderManagement.timeAvailable.time"],[4,"ngFor","ngForOf"],["scope","col",1,"border-1","text-center"],[4,"ngIf"],[1,"badge","d-inline-block","bg-primary-subtle","text-primary"],[1,"badge","d-inline-block","bg-success-subtle","text-success"],["translate","orderManagement.timeAvailable.holidayTeam",1,"badge","d-inline-block","bg-warning-subtle","text-warning"],[1,"p-0","flex-wrap","text-center"],["type","checkbox",1,"btn-check",3,"change","ngModelChange","disabled","ngModel","id"],[1,"btn","btn-outline-primary",3,"ngClass","for"],["translate","orderManagement.timeAvailable.block",4,"ngIf"],["translate","orderManagement.timeAvailable.unBlock",4,"ngIf"],["translate","orderManagement.timeAvailable.block"],["translate","orderManagement.timeAvailable.unBlock"]],template:function(p,c){1&p&&(n.j41(0,"div",0)(1,"div",1),n.DNE(2,U,9,6,"div",2),n.j41(3,"div",3)(4,"div",4),n.DNE(5,D,3,1,"button",5)(6,L,3,1,"button",6),n.k0s(),n.j41(7,"div",7)(8,"div",8)(9,"span",9),n.bIt("click",function(){return c.getTimeAvailables()}),n.nrm(10,"i",10),n.k0s(),n.j41(11,"input",11),n.nI1(12,"translate"),n.bIt("change",function(){return c.getChange()}),n.mxI("ngModelChange",function(E){return n.DH7(c.searchForm.date,E)||(c.searchForm.date=E),E}),n.k0s()()(),n.j41(13,"div",12),n.DNE(14,P,3,1,"button",5)(15,$,3,1,"button",13),n.k0s()()()(),n.DNE(16,Y,13,3,"div",14)),2&p&&(n.R7$(2),n.Y8G("ngIf",c.isShowFilter),n.R7$(3),n.Y8G("ngIf","ar"!=c.lang),n.R7$(),n.Y8G("ngIf","ar"==c.lang),n.R7$(5),n.FS9("placeholder",n.bMT(12,11,"orderManagement.timeAvailable.date")),n.Y8G("disabled",!c.isOrderEdit)("altInput",!0)("convertModelValue",!0),n.R50("ngModel",c.searchForm.date),n.R7$(3),n.Y8G("ngIf","ar"!=c.lang),n.R7$(),n.Y8G("ngIf","ar"==c.lang),n.R7$(),n.Y8G("ngIf",c.timesList.length>0))},dependencies:[T.YU,T.Sq,T.bT,_.me,_.Zm,_.BC,_.vS,O.Mm,M.vr,v.kL,l.Cv,O.D9]})}}return m})()}}]);